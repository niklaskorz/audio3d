(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{139:function(e,t,n){},141:function(e,t,n){"use strict";n.r(t);n(80);var a,o=n(0),i=n.n(o),r=n(31),c=n.n(r),s=n(7),u=n(13),l=n(2),d=n.n(l),p=n(8),h=n(4),m=n(3),f=n(10),v=n(9),b=n(11),j=n(1),y=n(22),w=n(33),x=n(34),g=n(35),A=n.n(g),O=function(){var e=Object(p.a)(d.a.mark(function e(t){var n,a,o,i,r,c,s,u,l,p,h,m,f,v;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.toData(),(a=new A.a).file("metadata.json",JSON.stringify(n)),o=[],i=a.folder("audio"),r=!0,c=!1,e.prev=7,u=Object(w.a)(t.audioLibrary.entries());case 9:return e.next=11,u.next();case 11:return l=e.sent,r=l.done,e.next=15,l.value;case 15:if(p=e.sent,r){e.next=23;break}h=p,m=Object(y.a)(h,2),f=m[0],v=m[1],o.push({id:f,name:v.name,type:v.type}),i.file(f.toString(),v.data);case 20:r=!0,e.next=9;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(7),c=!0,s=e.t0;case 29:if(e.prev=29,e.prev=30,r||null==u.return){e.next=34;break}return e.next=34,u.return();case 34:if(e.prev=34,!c){e.next=37;break}throw s;case 37:return e.finish(34);case 38:return e.finish(29);case 39:return a.file("audioLibrary.json",JSON.stringify(o)),e.abrupt("return",a.generateAsync({type:"blob"}));case 41:case"end":return e.stop()}},e,this,[[7,25,29,39],[30,,34,38]])}));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(p.a)(d.a.mark(function e(t){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t);case 2:n=e.sent,Object(x.saveAs)(n,"".concat(t.name,".audio3d.zip"));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),k=n(15),E=n(23),C=n(37),M=n(77),P=Object(M.a)("audio3d",2,{upgrade:function(e,t){1===t&&(e.deleteObjectStore("projects"),e.deleteObjectStore("audios")),e.createObjectStore("projects",{keyPath:"id",autoIncrement:!0}).createIndex("savedAt","savedAt"),e.createObjectStore("audios",{keyPath:["projectId","audioId"]}).createIndex("project","projectId")}}),I=function(){var e=Object(p.a)(d.a.mark(function e(t){var n,a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return n=e.sent,a=t.toData(),t.id&&(a.id=t.id),e.next=7,n.put("projects",a);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=Object(p.a)(d.a.mark(function e(t){var n,a,o,i,r;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return n=e.sent,a=n.transaction(["audios","projects"],"readwrite"),o=a.objectStore("projects"),i=a.objectStore("audios"),e.next=8,o.delete(t);case 8:return e.next=10,i.index("project").openKeyCursor(t);case 10:r=e.sent;case 11:if(!r){e.next=19;break}return e.next=14,i.delete(r.primaryKey);case 14:return e.next=16,r.continue();case 16:r=e.sent,e.next=11;break;case 19:return e.next=21,a.done;case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=Object(p.a)(d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return t=e.sent,e.next=5,t.getAllFromIndex("projects","savedAt");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),T=function(){var e=Object(p.a)(d.a.mark(function e(t,n){var a,o;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return a=e.sent,e.next=5,a.get("audios",[t,n]);case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),B=function(){var e=Object(p.a)(d.a.mark(function e(t){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return n=e.sent,e.next=5,n.put("audios",t);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(p.a)(d.a.mark(function e(t,n){var a,o,i,r,c,u,l,p,h,m,f;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:for(a=e.sent,o=a.transaction("audios","readwrite"),i=!0,r=!1,c=void 0,e.prev=7,u=n.entries()[Symbol.iterator]();!(i=(l=u.next()).done);i=!0)p=l.value,h=Object(y.a)(p,2),m=h[0],f=h[1],o.store.put(Object(s.a)({},f,{projectId:t,audioId:m}));e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),r=!0,c=e.t0;case 15:e.prev=15,e.prev=16,i||null==u.return||u.return();case 18:if(e.prev=18,!r){e.next=21;break}throw c;case 21:return e.finish(18);case 22:return e.finish(15);case 23:return e.next=25,o.done;case 25:case"end":return e.stop()}},e,this,[[7,11,15,23],[16,,18,22]])}));return function(t,n){return e.apply(this,arguments)}}(),F=function(){var e=Object(p.a)(d.a.mark(function e(t,n){var a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return a=e.sent,e.next=5,a.delete("audios",[t,n]);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}();function N(){return(N=Object(C.a)(d.a.mark(function e(t){var n,a,o;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.a)(P);case 2:return n=e.sent,a=n.transaction("audios"),e.next=6,Object(E.a)(a.store.index("project").openCursor(t));case 6:o=e.sent;case 7:if(!o){e.next=15;break}return e.next=10,[o.value.audioId,o.value];case 10:return e.next=12,Object(E.a)(o.continue());case 12:o=e.sent,e.next=7;break;case 15:return e.next=17,Object(E.a)(a.done);case 17:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}!function(e){e.WebAudio="Web Audio API",e.Binaural="BinauralFIR",e.ResonanceAudio="Resonance Audio"}(a||(a={}));var z=a,U=new AudioContext;function Y(){return(Y=Object(C.a)(d.a.mark(function e(t){var n,a,o,i,r,c;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,a=!1,o=void 0,e.prev=3,i=t[Symbol.iterator]();case 5:if(n=(r=i.next()).done){e.next=12;break}return c=r.value,e.next=9,c;case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),a=!0,o=e.t0;case 18:e.prev=18,e.prev=19,n||null==i.return||i.return();case 21:if(e.prev=21,!a){e.next=24;break}throw o;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}))).apply(this,arguments)}var X,Z=function(){function e(){Object(h.a)(this,e),this.projectId=void 0,this.audioMap=new Map,this.nextId=0}return Object(m.a)(e,[{key:"add",value:function(){var e=Object(p.a)(d.a.mark(function e(t){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.projectId){e.next=5;break}return e.next=3,B(Object(s.a)({},t,{projectId:this.projectId,audioId:this.nextId}));case 3:e.next=6;break;case 5:this.audioMap.set(this.nextId,t);case 6:return e.abrupt("return",this.nextId++);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(p.a)(d.a.mark(function e(t){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.projectId){e.next=4;break}return e.next=3,T(this.projectId,t);case 3:return e.abrupt("return",e.sent);case 4:return e.abrupt("return",this.audioMap.get(t));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(p.a)(d.a.mark(function e(t,n){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.projectId){e.next=5;break}return e.next=3,T(this.projectId,t);case 3:e.next=6;break;case 5:this.audioMap.set(t,n);case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(p.a)(d.a.mark(function e(t){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.projectId){e.next=5;break}return e.next=3,F(this.projectId,t);case 3:e.next=6;break;case 5:this.audioMap.delete(t);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveToProject",value:function(){var e=Object(p.a)(d.a.mark(function e(t){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.projectId=t,e.next=3,L(t,this.audioMap);case 3:this.audioMap.clear();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"entries",value:function(){return null!=this.projectId?function(e){return N.apply(this,arguments)}(this.projectId):function(e){return Y.apply(this,arguments)}(this.audioMap.entries())}}]),e}(),H=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(h.a)(this,e),this.source=void 0,this.func=void 0,this.source=t}return Object(m.a)(e,[{key:"update",value:function(e){this.source=e,this.func=void 0}},{key:"execute",value:function(e,t,n){try{this.func||(this.func=new Function("game","playerState","roomState",this.source)),this.func.call(e,t,t.playerState,n)}catch(a){console.error("Execution of code block failed with error:",a,"object:",e,"project:",t,"roomState:",n)}}}]),e}(),W=new j.d(1,1,1),G=new j.k;!function(e){e.None="No interaction",e.PlaySound="Play sound",e.Teleport="Teleport",e.CodeBlock="Code block"}(X||(X={}));var K=function(e){function t(e,n){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(v.a)(t).call(this,W,G))).audioLibrary=void 0,a.audioId=void 0,a.audioFile=void 0,a.audio=void 0,a.interactionType=X.None,a.interactionAudioId=void 0,a.codeBlock=void 0,a.teleportTarget=void 0,a.audioLibrary=e,a.audio=n.createAudio3D(),a.add(a.audio),a}return Object(b.a)(t,e),Object(m.a)(t,[{key:"volume",get:function(){return this.audio.volume},set:function(e){this.audio.volume=e}}]),Object(m.a)(t,[{key:"triggerInteraction",value:function(e){switch(this.interactionType){case X.CodeBlock:this.codeBlock&&this.codeBlock.execute(this,e,e.activeRoom.roomState);break;case X.Teleport:if(this.teleportTarget){var t=this.teleportTarget,n=t.roomId,a=t.spawnId;e.teleportPlayer(n,a)}null!=this.interactionAudioId&&this.playAudio(this.interactionAudioId);break;case X.PlaySound:null!=this.interactionAudioId&&this.playAudio(this.interactionAudioId)}}},{key:"playAudio",value:function(){var e=Object(p.a)(d.a.mark(function e(t){var n,a,o=arguments;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],this.audioId=t,e.next=4,this.audioLibrary.get(t);case 4:if(this.audioFile=e.sent,!this.audioFile){e.next=14;break}return e.next=8,U.decodeAudioData(this.audioFile.data.slice(0));case 8:a=e.sent,this.audio.setBuffer(a),this.audio.setLoop(n),this.audio.play(),e.next=15;break;case 14:console.log("Audio with id",t,"could not be found and can't be played");case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"toData",value:function(){return{uuid:this.uuid,name:this.name,volume:this.volume,position:this.position.toArray(),scale:this.scale.toArray(),rotation:this.rotation.toArray().slice(0,3),audioId:this.audioId,interactionType:this.interactionType,interactionAudioId:this.interactionAudioId,codeBlockSource:this.codeBlock&&this.codeBlock.source,teleportTarget:this.teleportTarget}}},{key:"fromData",value:function(e){return this.uuid=null!=e.uuid?e.uuid:this.uuid,this.name=e.name,this.position.set(e.position[0],e.position[1],e.position[2]),this.scale.set(e.scale[0],e.scale[1],e.scale[2]),this.rotation.set(e.rotation[0],e.rotation[1],e.rotation[2]),null!=e.audioId&&this.playAudio(e.audioId,!0),null!=e.volume&&(this.volume=e.volume),this.interactionType=e.interactionType||X.None,this.interactionAudioId=e.interactionAudioId,e.codeBlockSource&&(this.codeBlock=new H(e.codeBlockSource)),this.teleportTarget=e.teleportTarget,this}}]),t}(j.i),_=n(74),q=n.n(_),V=function(e){return 180*e/Math.PI},J=function(e){return e/180*Math.PI},Q=function(e,t){return Math.round(e/t)*t},$=function(){function e(t){Object(h.a)(this,e),this.position=new j.v,this.orientation=new j.v,this.scene=void 0,this.binauralFIR=void 0,this.scene=t,this.binauralFIR=new q.a({audioContext:t.audioContext}),this.binauralFIR.HRTFDataset=t.hrtfDataset,this.binauralFIR.connect(t.audioContext.destination)}return Object(m.a)(e,[{key:"input",get:function(){return this.binauralFIR.input}}]),Object(m.a)(e,[{key:"update",value:function(){var e=this.binauralFIR.distance(this.position,this.scene.listenerPosition),t=Math.atan2(this.position.x-this.scene.listenerPosition.x,-(this.position.z-this.scene.listenerPosition.z)),n=Math.atan2(this.scene.listenerOrientation.x,this.scene.listenerOrientation.z),a=Math.atan2(this.position.y-this.scene.listenerPosition.y,Math.sqrt(this.position.x-this.scene.listenerPosition.x-(this.position.z-this.scene.listenerPosition.z)));this.binauralFIR.setPosition(V(t+n),V(a),e)}}]),e}(),ee=[{azimuth:1,elevation:1,distance:1,buffer:U.createBuffer(2,512,U.sampleRate)}],te=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ee;Object(h.a)(this,e),this.listenerPosition=new j.v(0,0,0),this.listenerOrientation=new j.v(0,0,0),this.sources=[],this.audioContext=void 0,this.hrtfDataset=void 0,this.audioContext=t,this.hrtfDataset=n}return Object(m.a)(e,[{key:"createSource",value:function(){var e=new $(this);return this.sources.push(e),e}},{key:"setHRTFDataset",value:function(e){this.hrtfDataset=e;var t=!0,n=!1,a=void 0;try{for(var o,i=this.sources[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.binauralFIR.HRTFDataset=e}}catch(r){n=!0,a=r}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}}},{key:"update",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,o=this.sources[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.update()}}catch(i){t=!0,n=i}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}}]),e}(),ne=n(38),ae=function(e){function t(e,n,a,o,i,r){var c;return Object(h.a)(this,t),(c=Object(f.a)(this,Object(v.a)(t).call(this))).webAudioContext=void 0,c.binauralAudioContext=void 0,c.resonanceAudioContext=void 0,c.webAudioPannerNode=void 0,c.binauralSource=void 0,c.resonanceSource=void 0,c.webAudioGainNode=void 0,c.binauralGainNode=void 0,c.resonanceGainNode=void 0,c.webAudioBufferSource=void 0,c.binauralBufferSource=void 0,c.resonanceBufferSource=void 0,c.hasStarted=!1,c.isPlaying=!1,c.onAudioEnded=function(){c.stopAll(),c.isPlaying=!1},c.webAudioContext=e,c.binauralAudioContext=n,c.resonanceAudioContext=a,c.webAudioPannerNode=o,c.binauralSource=i,c.resonanceSource=r,c.webAudioGainNode=e.createGain(),c.binauralGainNode=n.createGain(),c.resonanceGainNode=a.createGain(),c.webAudioBufferSource=e.createBufferSource(),c.binauralBufferSource=n.createBufferSource(),c.resonanceBufferSource=a.createBufferSource(),c.webAudioBufferSource.connect(c.webAudioGainNode),c.binauralBufferSource.connect(c.binauralGainNode),c.resonanceBufferSource.connect(c.resonanceGainNode),c.webAudioGainNode.connect(o),c.binauralGainNode.connect(i.input),c.resonanceGainNode.connect(r.input),c.webAudioPannerNode.connect(e.destination),c.webAudioBufferSource.onended=c.onAudioEnded,c.binauralBufferSource.onended=c.onAudioEnded,c.resonanceBufferSource.onended=c.onAudioEnded,c}return Object(b.a)(t,e),Object(m.a)(t,[{key:"volume",get:function(){return this.webAudioGainNode.gain.value},set:function(e){this.webAudioGainNode.gain.value=e,this.binauralGainNode.gain.value=e,this.resonanceGainNode.gain.value=e}}]),Object(m.a)(t,[{key:"updateMatrixWorld",value:function(e){Object(ne.a)(Object(v.a)(t.prototype),"updateMatrixWorld",this).call(this,e);var n=new j.v,a=new j.q,o=new j.v;this.matrixWorld.decompose(n,a,o);var i=new j.v(0,0,1).applyQuaternion(a);this.webAudioPannerNode.setPosition(n.x,n.y,n.z),this.webAudioPannerNode.setOrientation(i.x,i.y,i.z),this.binauralSource.position.copy(n),this.binauralSource.orientation.copy(i),this.binauralSource.update(),this.resonanceSource.setFromMatrix(this.matrixWorld)}},{key:"setBuffer",value:function(e){this.webAudioBufferSource.buffer&&(this.stop(),this.webAudioBufferSource=this.webAudioContext.createBufferSource(),this.binauralBufferSource=this.binauralAudioContext.createBufferSource(),this.resonanceBufferSource=this.resonanceAudioContext.createBufferSource(),this.webAudioBufferSource.connect(this.webAudioGainNode),this.binauralBufferSource.connect(this.binauralGainNode),this.resonanceBufferSource.connect(this.resonanceGainNode),this.webAudioBufferSource.onended=this.onAudioEnded,this.binauralBufferSource.onended=this.onAudioEnded,this.resonanceBufferSource.onended=this.onAudioEnded),this.webAudioBufferSource.buffer=e,this.binauralBufferSource.buffer=e,this.resonanceBufferSource.buffer=e,this.hasStarted=!1,this.isPlaying=!1}},{key:"play",value:function(){this.webAudioBufferSource.buffer&&(this.hasStarted&&this.setBuffer(this.webAudioBufferSource.buffer),this.webAudioBufferSource.start(),this.binauralBufferSource.start(),this.resonanceBufferSource.start(),this.hasStarted=!0,this.isPlaying=!0)}},{key:"stop",value:function(){this.isPlaying=!1,this.hasStarted&&this.stopAll()}},{key:"stopAll",value:function(){try{this.webAudioBufferSource.stop(),this.binauralBufferSource.stop(),this.resonanceBufferSource.stop(),this.webAudioBufferSource.disconnect(),this.binauralBufferSource.disconnect(),this.resonanceBufferSource.disconnect()}catch(e){console.log("Audio could not be stopped:",e)}}},{key:"setLoop",value:function(e){this.webAudioBufferSource.loop=e,this.binauralBufferSource.loop=e,this.resonanceBufferSource.loop=e}},{key:"setDistanceModel",value:function(e){this.webAudioPannerNode.distanceModel=e,this.binauralBufferSource.onended=this.onAudioEnded,this.resonanceBufferSource.onended=this.onAudioEnded}}]),t}(j.l),oe=function(e){function t(e,n,a){var o;return Object(h.a)(this,t),(o=Object(f.a)(this,Object(v.a)(t).call(this))).webAudioListener=void 0,o.binauralScene=void 0,o.resonanceScene=void 0,o.webAudioListener=e,o.binauralScene=n,o.resonanceScene=a,o}return Object(b.a)(t,e),Object(m.a)(t,[{key:"updateMatrixWorld",value:function(e){Object(ne.a)(Object(v.a)(t.prototype),"updateMatrixWorld",this).call(this,e);var n=new j.v,a=new j.q,o=new j.v;this.matrixWorld.decompose(n,a,o);var i=new j.v(0,0,1).applyQuaternion(a);this.webAudioListener.setPosition(n.x,n.y,n.z),this.webAudioListener.setOrientation(-i.x,i.y,-i.z,this.up.x,this.up.y,this.up.z),this.binauralScene.listenerPosition.copy(n),this.binauralScene.listenerOrientation.copy(i),this.binauralScene.update(),this.resonanceScene.setListenerFromMatrix(this.matrixWorld)}}]),t}(j.l),ie=function(e,t){var n=U.createBuffer(2,512,U.sampleRate);return n.copyToChannel(new Float32Array(e),0),n.copyToChannel(new Float32Array(t),1),n},re=function(){var e=Object(p.a)(d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("data/ircam-hrtf.json");case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.abrupt("return",n.map(function(e){return{azimuth:e.azimuth,elevation:e.elevation,distance:e.distance,buffer:ie(e.fir_coeffs_left,e.fir_coeffs_right)}}));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),ce=function(){function e(t){Object(h.a)(this,e),this.audioImplementation=z.WebAudio,this.webAudioContext=new AudioContext,this.binauralAudioContext=new AudioContext,this.resonanceAudioContext=new AudioContext,this.binauralScene=new te(this.binauralAudioContext),this.resonanceScene=new k.ResonanceAudio(this.resonanceAudioContext),this.binauralHRTFDataset=null,this.isLoadingBinauralHRTFDataset=!1,this.listener3D=new oe(this.webAudioContext.listener,this.binauralScene,this.resonanceScene),this.resonanceScene.setRoomProperties(t.dimensions||k.ResonanceAudio.Utils.DEFAULT_ROOM_DIMENSIONS,t.materials||k.ResonanceAudio.Utils.DEFAULT_ROOM_MATERIALS),this.resonanceScene.output.connect(this.resonanceAudioContext.destination),this.suspend()}return Object(m.a)(e,[{key:"createAudio3D",value:function(){return new ae(this.webAudioContext,this.binauralAudioContext,this.resonanceAudioContext,this.webAudioContext.createPanner(),this.binauralScene.createSource(),this.resonanceScene.createSource())}},{key:"close",value:function(){this.webAudioContext.close(),this.binauralAudioContext.close(),this.resonanceAudioContext.close()}},{key:"suspend",value:function(){this.webAudioContext.suspend(),this.binauralAudioContext.suspend(),this.resonanceAudioContext.suspend()}},{key:"resume",value:function(){switch(this.audioImplementation){case z.WebAudio:this.webAudioContext.resume();break;case z.Binaural:this.binauralAudioContext.resume();break;case z.ResonanceAudio:this.resonanceAudioContext.resume()}}},{key:"selectAudioImplementation",value:function(e){e!==z.Binaural||this.binauralHRTFDataset||this.isLoadingBinauralHRTFDataset||this.loadBinauralHRTFDataset(),this.suspend(),this.audioImplementation=e,this.resume()}},{key:"loadBinauralHRTFDataset",value:function(){var e=Object(p.a)(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.isLoadingBinauralHRTFDataset=!0,e.prev=1,e.next=4,re();case 4:this.binauralHRTFDataset=e.sent,this.binauralScene.setHRTFDataset(this.binauralHRTFDataset),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error("Failed loading BinauralFIR HRTF dataset:",e.t0);case 11:this.isLoadingBinauralHRTFDataset=!1;case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"setRoomProperties",value:function(e,t){this.resonanceScene.setRoomProperties(e,t)}}]),e}(),se=new j.d(1,.1,1),ue=new j.k({color:65280}),le=new j.d(.1,.1,.5),de=function(e){function t(){var e;Object(h.a)(this,t),(e=Object(f.a)(this,Object(v.a)(t).call(this,se,ue))).position.set(0,.05,2);var n=new j.i(le,ue);return n.position.z=-.5,e.add(n),e}return Object(b.a)(t,e),Object(m.a)(t,[{key:"toData",value:function(){return{uuid:this.uuid,name:this.name,position:[this.position.x,this.position.z],rotation:this.rotation.y}}},{key:"fromData",value:function(e){return this.uuid=e.uuid,this.name=e.name,this.position.set(e.position[0],.05,e.position[1]),this.rotation.set(0,e.rotation,0),this}}]),t}(j.i),pe=new j.d(1,1,1),he=new j.k,me=function(e){function t(e,n){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{width:15,depth:15,height:3},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:k.ResonanceAudio.Utils.DEFAULT_ROOM_MATERIALS;Object(h.a)(this,t),(a=Object(f.a)(this,Object(v.a)(t).call(this))).audioLibrary=void 0,a.roomDimensions=void 0,a.roomMaterials=void 0,a.project=void 0,a.grid=void 0,a.wallNorth=new j.i(pe,he),a.wallEast=new j.i(pe,he),a.wallSouth=new j.i(pe,he),a.wallWest=new j.i(pe,he),a.camera=new j.m(60,1,.1,1e3),a.collisionAudio=void 0,a.footstepAudio=void 0,a.interactAvailAudio=void 0,a.roomState=new Map,a.audioScene=void 0,a.spawns=[],a.audioLibrary=n,a.name=o,a.roomDimensions=i,a.roomMaterials=r,a.project=e;var c=new j.a(16777215,.5);a.add(c);var s=new j.p(16777215,.5);s.position.set(5,5,0),s.lookAt(0,0,0),a.add(s);var u=Math.max(i.width,i.depth);return a.grid=new j.h(u,u,16777215,16777215),a.add(a.grid),a.updateWalls(),a.add(a.wallNorth),a.add(a.wallEast),a.add(a.wallSouth),a.add(a.wallWest),a.camera.position.z=4,a.camera.position.y=3,a.camera.lookAt(new j.v(0,1,0)),a.audioScene=new ce({dimensions:i,materials:r}),a.camera.add(a.audioScene.listener3D),a.collisionAudio=a.audioScene.createAudio3D(),a.footstepAudio=a.audioScene.createAudio3D(),a.interactAvailAudio=a.audioScene.createAudio3D(),a.camera.add(a.footstepAudio),a.add(a.collisionAudio),a.add(a.interactAvailAudio),a}return Object(b.a)(t,e),Object(m.a)(t,[{key:"dimensions",get:function(){return this.roomDimensions},set:function(e){this.roomDimensions=e,this.audioScene.setRoomProperties(e,this.roomMaterials),this.remove(this.grid);var t=Math.max(e.width,e.depth);this.grid=new j.h(t,t,16777215,16777215),this.add(this.grid),this.updateWalls()}},{key:"materials",get:function(){return this.roomMaterials},set:function(e){this.roomMaterials=e,this.audioScene.setRoomProperties(this.roomDimensions,e)}}]),Object(m.a)(t,[{key:"addSpawn",value:function(){var e=new de;return e.name="New spawn",this.spawns.push(e),this.add(e),e}},{key:"addObject",value:function(){var e=new K(this.audioLibrary,this.audioScene);return e.position.y+=.5,e.name="New object",e.audio.webAudioPannerNode.panningModel=this.project.panningModel,e.audio.webAudioPannerNode.distanceModel=this.project.distanceModel,e.audio.resonanceSource.setRolloff(this.project.rollofModel),this.add(e),e}},{key:"updateWalls",value:function(){var e=this.roomDimensions,t=e.width,n=e.depth,a=e.height;this.wallNorth.scale.set(t,a,.25),this.wallEast.scale.set(.25,a,n),this.wallSouth.scale.set(t,a,.25),this.wallWest.scale.set(.25,a,n),this.wallNorth.position.set(0,a/2,n/2),this.wallEast.position.set(t/2,a/2,0),this.wallSouth.position.set(0,a/2,-n/2),this.wallWest.position.set(-t/2,a/2,0)}},{key:"toData",value:function(){return{uuid:this.uuid,name:this.name,dimensions:this.dimensions,materials:this.materials,spawns:this.spawns.map(function(e){return e.toData()}),objects:this.children.filter(function(e){return e instanceof K}).map(function(e){return e.toData()})}}},{key:"fromData",value:function(e){var t=this;this.uuid=null!=e.uuid?e.uuid:this.uuid,this.name=e.name,this.dimensions=e.dimensions,e.materials&&(this.materials=e.materials),e.spawns?(this.spawns=e.spawns.map(function(e){return(new de).fromData(e)}),this.add.apply(this,Object(u.a)(this.spawns))):this.addSpawn();var n=e.objects.map(function(e){return new K(t.audioLibrary,t.audioScene).fromData(e)});return this.add.apply(this,Object(u.a)(n)),this}}]),t}(j.s),fe=function(){},ve={onSelectSpawn:fe,onSelectObject:fe,onScale:fe,onTranslate:fe},be=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve;Object(h.a)(this,e),this.events=void 0,this.audioLibrary=new Z,this.id=void 0,this.name="New project",this.rooms=[],this.panningModel="equalpower",this.distanceModel="inverse",this.ambisonicOrder=k.ResonanceAudio.Utils.DEFAULT_AMBISONIC_ORDER,this.rollofModel=k.ResonanceAudio.Utils.DEFAULT_ATTENUATION_ROLLOFF,this.playerHeight=1.8,this.playerState=new Map,this.collisionAudioId=void 0,this.footstepAudioId=void 0,this.interactAvailAudioId=void 0,this.collisionAudioFile=void 0,this.footstepAudioFile=void 0,this.interactAvailAudioFile=void 0,this.collisionAudioBuffer=void 0,this.footstepAudioBuffer=void 0,this.interactAvailAudioBuffer=void 0,this.activeAudioImplementation=z.WebAudio,this.activeRoom=void 0,this.activeSpawn=null,this.activeObject=null,this.outlineMesh=new j.i,this.events=t;var n=new me(this,this.audioLibrary,"First room");n.addSpawn(),n.addObject(),this.rooms.push(n),this.activeRoom=n,this.outlineMesh.material=new j.j({color:16777215,side:j.b}),this.outlineMesh.scale.multiplyScalar(1.05)}return Object(m.a)(e,[{key:"camera",get:function(){return this.activeRoom.camera}}]),Object(m.a)(e,[{key:"close",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,o=this.rooms[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.audioScene.close()}}catch(i){t=!0,n=i}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}},{key:"suspend",value:function(){this.activeRoom.audioScene.suspend()}},{key:"resume",value:function(){this.activeRoom.audioScene.resume()}},{key:"addRoom",value:function(){var e=new me(this,this.audioLibrary,"New room");return e.addSpawn(),e.addObject(),e.audioScene.resonanceScene.setAmbisonicOrder(this.ambisonicOrder),this.collisionAudioBuffer&&e.collisionAudio.setBuffer(this.collisionAudioBuffer),this.footstepAudioBuffer&&e.footstepAudio.setBuffer(this.footstepAudioBuffer),this.interactAvailAudioBuffer&&e.interactAvailAudio.setBuffer(this.interactAvailAudioBuffer),this.rooms.push(e),this.selectRoom(e),e}},{key:"selectPanningModel",value:function(e){var t=!0,n=!1,a=void 0;try{for(var o,i=this.rooms[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value,c=!0,s=!1,u=void 0;try{for(var l,d=r.children[Symbol.iterator]();!(c=(l=d.next()).done);c=!0){var p=l.value;p instanceof K&&(p.audio.webAudioPannerNode.panningModel=e)}}catch(h){s=!0,u=h}finally{try{c||null==d.return||d.return()}finally{if(s)throw u}}}}catch(h){n=!0,a=h}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}this.panningModel=e}},{key:"selectDistanceModel",value:function(e){var t=!0,n=!1,a=void 0;try{for(var o,i=this.rooms[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value,c=!0,s=!1,u=void 0;try{for(var l,d=r.children[Symbol.iterator]();!(c=(l=d.next()).done);c=!0){var p=l.value;p instanceof K&&(p.audio.webAudioPannerNode.distanceModel=e)}}catch(h){s=!0,u=h}finally{try{c||null==d.return||d.return()}finally{if(s)throw u}}}}catch(h){n=!0,a=h}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}this.distanceModel=e}},{key:"selectAmbisonicOrder",value:function(e){var t=!0,n=!1,a=void 0;try{for(var o,i=this.rooms[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.audioScene.resonanceScene.setAmbisonicOrder(e)}}catch(r){n=!0,a=r}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}this.ambisonicOrder=e}},{key:"selectRollofModel",value:function(e){var t=!0,n=!1,a=void 0;try{for(var o,i=this.rooms[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value,c=!0,s=!1,u=void 0;try{for(var l,d=r.children[Symbol.iterator]();!(c=(l=d.next()).done);c=!0){var p=l.value;p instanceof K&&p.audio.resonanceSource.setRolloff(e)}}catch(h){s=!0,u=h}finally{try{c||null==d.return||d.return()}finally{if(s)throw u}}}}catch(h){n=!0,a=h}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}this.rollofModel=e}},{key:"selectAudioImplementation",value:function(e){this.activeAudioImplementation=e,this.activeRoom.audioScene.selectAudioImplementation(e)}},{key:"selectRoom",value:function(e){this.activeRoom.audioScene.suspend(),e.audioScene.selectAudioImplementation(this.activeAudioImplementation),e.camera.aspect=this.activeRoom.camera.aspect,e.camera.updateProjectionMatrix(),this.activeRoom=e,this.unselect()}},{key:"unselect",value:function(){this.activeSpawn&&(this.activeSpawn.remove(this.outlineMesh),this.activeSpawn=null,this.events.onSelectSpawn(null)),this.activeObject&&(this.activeObject.remove(this.outlineMesh),this.activeObject=null,this.events.onSelectObject(null))}},{key:"selectSpawn",value:function(e){this.unselect(),this.outlineMesh.geometry=e.geometry,e.add(this.outlineMesh),this.activeSpawn=e,this.events.onSelectSpawn(e)}},{key:"selectObject",value:function(e){this.unselect(),this.outlineMesh.geometry=e.geometry,e.add(this.outlineMesh),this.activeObject=e,this.events.onSelectObject(e)}},{key:"teleportPlayer",value:function(e,t){var n=this.rooms.find(function(t){return t.uuid===e});if(n){this.selectRoom(n);var a=t&&n.spawns.find(function(e){return e.uuid===t})||n.spawns[0];n.camera.position.set(a.position.x,this.playerHeight-.1,a.position.z),n.camera.rotation.set(0,a.rotation.y,0)}else console.log("Target room not found, not teleporting")}},{key:"setCollisionAudio",value:function(){var e=Object(p.a)(d.a.mark(function e(t){var n,a,o,i,r,c;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.collisionAudioId=t,e.next=3,this.audioLibrary.get(t);case 3:if(this.collisionAudioFile=e.sent,!this.collisionAudioFile){e.next=29;break}return e.next=7,U.decodeAudioData(this.collisionAudioFile.data.slice(0));case 7:for(this.collisionAudioBuffer=e.sent,n=!0,a=!1,o=void 0,e.prev=11,i=this.rooms[Symbol.iterator]();!(n=(r=i.next()).done);n=!0)(c=r.value).collisionAudio.setBuffer(this.collisionAudioBuffer),c.collisionAudio.setLoop(!1);e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),a=!0,o=e.t0;case 19:e.prev=19,e.prev=20,n||null==i.return||i.return();case 22:if(e.prev=22,!a){e.next=25;break}throw o;case 25:return e.finish(22);case 26:return e.finish(19);case 27:e.next=30;break;case 29:console.log("Audio with id",t,"could not be found and can't be played");case 30:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26]])}));return function(t){return e.apply(this,arguments)}}()},{key:"setFootstepAudio",value:function(){var e=Object(p.a)(d.a.mark(function e(t){var n,a,o,i,r,c;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.footstepAudioId=t,e.next=3,this.audioLibrary.get(t);case 3:if(this.footstepAudioFile=e.sent,!this.footstepAudioFile){e.next=29;break}return e.next=7,U.decodeAudioData(this.footstepAudioFile.data.slice(0));case 7:for(this.footstepAudioBuffer=e.sent,n=!0,a=!1,o=void 0,e.prev=11,i=this.rooms[Symbol.iterator]();!(n=(r=i.next()).done);n=!0)(c=r.value).footstepAudio.setBuffer(this.footstepAudioBuffer),c.footstepAudio.setLoop(!1);e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),a=!0,o=e.t0;case 19:e.prev=19,e.prev=20,n||null==i.return||i.return();case 22:if(e.prev=22,!a){e.next=25;break}throw o;case 25:return e.finish(22);case 26:return e.finish(19);case 27:e.next=30;break;case 29:console.log("Audio with id",t,"could not be found and can't be played");case 30:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26]])}));return function(t){return e.apply(this,arguments)}}()},{key:"setInteractAvailAudio",value:function(){var e=Object(p.a)(d.a.mark(function e(t){var n,a,o,i,r,c;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.interactAvailAudioId=t,e.next=3,this.audioLibrary.get(t);case 3:if(this.interactAvailAudioFile=e.sent,!this.interactAvailAudioFile){e.next=29;break}return e.next=7,U.decodeAudioData(this.interactAvailAudioFile.data.slice(0));case 7:for(this.interactAvailAudioBuffer=e.sent,n=!0,a=!1,o=void 0,e.prev=11,i=this.rooms[Symbol.iterator]();!(n=(r=i.next()).done);n=!0)(c=r.value).interactAvailAudio.setBuffer(this.interactAvailAudioBuffer),c.interactAvailAudio.setLoop(!1);e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),a=!0,o=e.t0;case 19:e.prev=19,e.prev=20,n||null==i.return||i.return();case 22:if(e.prev=22,!a){e.next=25;break}throw o;case 25:return e.finish(22);case 26:return e.finish(19);case 27:e.next=30;break;case 29:console.log("Audio with id",t,"could not be found and can't be played");case 30:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26]])}));return function(t){return e.apply(this,arguments)}}()},{key:"save",value:function(){var e=Object(p.a)(d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(this);case 2:if(t=e.sent,null!=this.id){e.next=7;break}return this.id=t,e.next=7,this.audioLibrary.saveToProject(t);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"toData",value:function(){return{savedAt:new Date,name:this.name,rooms:this.rooms.map(function(e){return e.toData()}),nextAudioId:this.audioLibrary.nextId,audioImplementation:this.activeAudioImplementation,panningModel:this.panningModel,distanceModel:this.distanceModel,ambisonicOrder:this.ambisonicOrder,rollofModel:this.rollofModel,collisionAudioId:this.collisionAudioId,footstepAudioId:this.footstepAudioId,interactAvailAudioId:this.interactAvailAudioId}}},{key:"fromData",value:function(e,t,n){var a=this;this.id=t,n?this.audioLibrary=n:(this.audioLibrary.projectId=t,this.audioLibrary.nextId=e.nextAudioId||0),this.name=e.name,this.rooms=e.rooms.map(function(e){return new me(a,a.audioLibrary).fromData(e)}),this.activeRoom=this.rooms[0];for(var o=1;o<this.rooms.length;o++)this.rooms[o].audioScene.suspend();return e.audioImplementation&&this.selectAudioImplementation(e.audioImplementation),e.panningModel&&this.selectPanningModel(e.panningModel),e.distanceModel&&this.selectDistanceModel(e.distanceModel),e.ambisonicOrder&&this.selectAmbisonicOrder(e.ambisonicOrder),e.rollofModel&&this.selectRollofModel(e.rollofModel),null!=e.collisionAudioId&&this.setCollisionAudio(e.collisionAudioId),null!=e.footstepAudioId&&this.setFootstepAudio(e.footstepAudioId),null!=e.interactAvailAudioId&&this.setInteractAvailAudio(e.interactAvailAudioId),this}}]),e}(),je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t){var n=document.createElement("input");n.type="file",e.accept&&(n.accept=e.accept),n.onchange=function(){n.files&&t(n.files[0])},n.click()})},ye=function(e){return new Promise(function(t){var n=new FileReader;n.onload=function(){n.result&&t(n.result)},n.onerror=function(){console.error("Error:",n.error)},n.readAsArrayBuffer(e)})},we=function(){var e=Object(p.a)(d.a.mark(function e(t){var n,a,o,i,r,c,s,u,l,p,h,m,f,v,b;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.a.loadAsync(t);case 2:return n=e.sent,e.t0=JSON,e.next=6,n.file("metadata.json").async("text");case 6:return e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),e.t2=JSON,e.next=11,n.file("audioLibrary.json").async("text");case 11:e.t3=e.sent,o=e.t2.parse.call(e.t2,e.t3),i=n.folder("audio"),r=new be,c=!0,s=!1,u=void 0,e.prev=18,l=o[Symbol.iterator]();case 20:if(c=(p=l.next()).done){e.next=33;break}return h=p.value,m=h.id,f=h.name,v=h.type,e.next=27,i.file(m.toString()).async("arraybuffer");case 27:b=e.sent,r.audioLibrary.set(m,{name:f,type:v,data:b}),m>=r.audioLibrary.nextId&&(r.audioLibrary.nextId=m+1);case 30:c=!0,e.next=20;break;case 33:e.next=39;break;case 35:e.prev=35,e.t4=e.catch(18),s=!0,u=e.t4;case 39:e.prev=39,e.prev=40,c||null==l.return||l.return();case 42:if(e.prev=42,!s){e.next=45;break}throw u;case 45:return e.finish(42);case 46:return e.finish(39);case 47:return r.fromData(a),e.abrupt("return",r);case 49:case"end":return e.stop()}},e,this,[[18,35,39,47],[40,,42,46]])}));return function(t){return e.apply(this,arguments)}}(),xe=function(){var e=Object(p.a)(d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je({accept:"application/zip"});case 2:return t=e.sent,e.next=5,we(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),ge=function(){function e(){Object(h.a)(this,e),this.onGamepadConnected=function(e){console.log("Gamepad connected:",e.gamepad)},this.onGamepadDisconnected=function(e){console.log("Gamepad disconnected:",e.gamepad)}}return Object(m.a)(e,[{key:"listen",value:function(){window.addEventListener("gamepadconnected",this.onGamepadConnected),window.addEventListener("gamepaddisconnected",this.onGamepadDisconnected)}},{key:"stop",value:function(){window.removeEventListener("gamepadconnected",this.onGamepadConnected),window.removeEventListener("gamepaddisconnected",this.onGamepadDisconnected)}},{key:"getAxis",value:function(e){var t=navigator.getGamepads(),n=0,a=!0,o=!1,i=void 0;try{for(var r,c=t[Symbol.iterator]();!(a=(r=c.next()).done);a=!0){var s=r.value;if(s&&"standard"===s.mapping)if(e<4){var u=s.axes[e];Math.abs(u)>=.15&&Math.abs(u)>Math.abs(n)&&(n=u)}else if(4===e){var l=s.buttons[6].value,d=s.buttons[7].value-l;Math.abs(d)>Math.abs(n)&&(n=d)}}}catch(p){o=!0,i=p}finally{try{a||null==c.return||c.return()}finally{if(o)throw i}}return n}},{key:"getButtonStatus",value:function(e){var t=navigator.getGamepads(),n=!0,a=!1,o=void 0;try{for(var i,r=t[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var c=i.value;if(c&&"standard"===c.mapping&&c.buttons[e].pressed)return!0}}catch(s){a=!0,o=s}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}return!1}}]),e}(),Ae=function(e){return e.length>1?e:e.toLocaleLowerCase()},Oe=function(){function e(t){var n=this;Object(h.a)(this,e),this.target=void 0,this.keysPressed=new Set,this.lastKeyUp=new Map,this.reset=function(){n.keysPressed.clear()},this.onKeyDown=function(e){e.preventDefault();var t=Ae(e.key);Math.abs(e.timeStamp-(n.lastKeyUp.get(t)||0))>=100&&n.keysPressed.add(t)},this.onKeyUp=function(e){e.preventDefault();var t=Ae(e.key);n.keysPressed.delete(t),n.lastKeyUp.set(t,e.timeStamp)},this.onClick=function(e){2===e.button&&e.shiftKey&&n.reset()},this.target=t}return Object(m.a)(e,[{key:"listen",value:function(){this.target.addEventListener("blur",this.reset),this.target.addEventListener("contextmenu",this.reset),this.target.addEventListener("keydown",this.onKeyDown),this.target.addEventListener("keyup",this.onKeyUp),document.addEventListener("click",this.onClick)}},{key:"stop",value:function(){this.target.removeEventListener("blur",this.reset),this.target.removeEventListener("contextmenu",this.reset),this.target.removeEventListener("keydown",this.onKeyDown),this.target.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("click",this.onClick),this.reset()}},{key:"isPressed",value:function(e){return this.keysPressed.has(e)}}]),e}(),Se={x:new j.v(1,0,0),y:new j.v(0,1,0),z:new j.v(0,0,1)},ke=function(){function e(t){var n=this;Object(h.a)(this,e),this.target=null,this.project=void 0,this.rafHandle=0,this.previousTimestamp=0,this.lastCollisionSound=0,this.lastKnownButtonStatus=!1,this.shouldRender=!0,this.renderer=new j.w,this.canvas=void 0,this.raycaster=new j.r,this.dummyCamera=new j.l,this.keys=new Oe(this.renderer.domElement),this.gamepads=new ge,this.resize=function(){if(n.target){var e=n.target,t=e.offsetWidth,a=e.offsetHeight;n.project.camera.aspect=t/a,n.project.camera.updateProjectionMatrix(),n.renderer.setPixelRatio(window.devicePixelRatio),n.renderer.setSize(t,a)}},this.animate=function(e){n.rafHandle=window.requestAnimationFrame(n.animate);var t=(e-n.previousTimestamp)/1e3;n.previousTimestamp=e,n.update(t),n.shouldRender?n.renderer.render(n.project.activeRoom,n.project.camera):(n.project.activeRoom.updateMatrixWorld(),n.project.activeRoom.camera.updateMatrixWorld(!1))},this.project=t,this.canvas=this.renderer.domElement,this.canvas.tabIndex=-1;var a=this.project.rooms[0];this.project.selectRoom(a);var o=a.spawns[0];this.project.camera.position.set(o.position.x,this.project.playerHeight-.1,o.position.z),this.project.camera.rotation.set(0,o.rotation.y,0)}return Object(m.a)(e,[{key:"attach",value:function(e){this.keys.listen(),this.gamepads.listen(),this.target=e,e.appendChild(this.canvas),this.resize(),window.requestAnimationFrame(this.animate),window.addEventListener("resize",this.resize)}},{key:"detach",value:function(){window.cancelAnimationFrame(this.rafHandle),window.removeEventListener("resize",this.resize),this.target&&(this.target.removeChild(this.canvas),this.target=null),this.keys.stop(),this.gamepads.stop()}},{key:"focus",value:function(){this.canvas.focus()}},{key:"toggleRendering",value:function(){this.shouldRender=!this.shouldRender,this.renderer.clear()}},{key:"isBetween",value:function(e,t,n){var a=Math.min.apply(Math,[t,n]),o=Math.max.apply(Math,[t,n]);return e>=a&&e<=o}},{key:"invokeInteraction",value:function(){var e=this.project.activeObject;return null!=e&&(e.triggerInteraction(this.project),!0)}},{key:"update",value:function(e){var t=this.project.camera;this.dummyCamera.position.copy(t.position),this.dummyCamera.rotation.copy(t.rotation);var n=0,a=0,o=0;if(this.keys.isPressed("w")){var i=-2*e;a=Math.abs(a)<Math.abs(i)?i:a}if(this.keys.isPressed("s")){var r=2*e;a=Math.abs(a)<Math.abs(r)?r:a}if(this.keys.isPressed("a")){var c=-2*e;n=Math.abs(n)<Math.abs(c)?c:n}if(this.keys.isPressed("d")){var s=2*e;n=Math.abs(n)<Math.abs(s)?s:n}if(this.keys.isPressed("ArrowLeft")){var u=e;o=Math.abs(o)<Math.abs(u)?u:o}if(this.keys.isPressed("ArrowRight")){var l=-e;o=Math.abs(o)<Math.abs(l)?l:o}var d=this.gamepads.getAxis(0),p=this.gamepads.getAxis(1),h=this.gamepads.getAxis(2);if(d){var m=2*e*d;n=Math.abs(n)<Math.abs(m)?m:n}if(p){var f=2*e*p;a=Math.abs(a)<Math.abs(f)?f:a}if(h){var v=-e*h;o=Math.abs(o)<Math.abs(v)?v:o}t.rotateOnWorldAxis(Se.y,o),this.dummyCamera.translateOnAxis(Se.z,a),this.dummyCamera.translateOnAxis(Se.x,n);var b=this.dummyCamera.position.x,y=this.dummyCamera.position.z,w=!1,x=!0,g=!1,A=void 0;try{for(var O,S=this.project.activeRoom.children[Symbol.iterator]();!(x=(O=S.next()).done);x=!0){var k=O.value;if(k instanceof j.i&&!(k instanceof de)){var E=(new j.c).setFromObject(k),C=E.getCenter(new j.v),M=E.getSize(new j.v),P=C.x+M.x/2+.25,I=C.x-M.x/2-.25,R=C.y+M.y/2+.05,D=C.y-M.y/2-.05,T=C.z+M.z/2+.25,B=C.z-M.z/2-.25;this.isBetween(b,I,P)&&this.isBetween(y,B,T)&&(this.isBetween(R,0,this.project.playerHeight)||this.isBetween(D,0,this.project.playerHeight)||this.isBetween(this.project.playerHeight,D,R)&&this.isBetween(0,D,R))&&(w=!0)}}}catch(q){g=!0,A=q}finally{try{x||null==S.return||S.return()}finally{if(g)throw A}}w?this.lastCollisionSound+1e3<Date.now()&&(this.project.activeRoom.collisionAudio.isPlaying||(this.lastCollisionSound=Date.now(),this.project.activeRoom.collisionAudio.position.copy(this.dummyCamera.position),this.project.activeRoom.collisionAudio.position.y-=(this.project.playerHeight-.1)/2,this.project.activeRoom.collisionAudio.play(),console.log("playing collision"))):0==n&&0==a||(t.position.copy(this.dummyCamera.position),this.project.activeRoom.footstepAudio.isPlaying||this.project.activeRoom.footstepAudio.play());for(var L=1/0,F=null,N=1;N>=-1;N-=.1){this.raycaster.setFromCamera({x:0,y:N},t);var z=this.raycaster.intersectObjects(this.project.activeRoom.children),U=!0,Y=!1,Z=void 0;try{for(var H,W=z[Symbol.iterator]();!(U=(H=W.next()).done);U=!0){var G=H.value,_=G.object;_ instanceof K&&G.distance<L&&(L=G.distance,F=_)}}catch(q){Y=!0,Z=q}finally{try{U||null==W.return||W.return()}finally{if(Y)throw Z}}}L<=1.5&&null!=F&&F.interactionType!==X.None?(this.project.activeRoom.interactAvailAudio.isPlaying||(this.project.activeRoom.interactAvailAudio.position.copy(F.position),this.project.activeRoom.interactAvailAudio.play()),this.project.selectObject(F)):this.project.unselect(),!this.gamepads.getButtonStatus(0)&&!this.keys.isPressed("e")||this.lastKnownButtonStatus?this.gamepads.getButtonStatus(0)||this.keys.isPressed("e")||(this.lastKnownButtonStatus=!1):(this.lastKnownButtonStatus=!0,this.invokeInteraction())}}]),e}(),Ee=n(5),Ce=n(6);function Me(){var e=Object(Ee.a)(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background-color: black;\n\n  :focus-within > "," {\n    display: block;\n  }\n"]);return Me=function(){return e},e}function Pe(){var e=Object(Ee.a)(["\n  border: 0px solid transparent;\n  border-collapse: collapse;\n  font-size: 15px;\n  width: 100%;\n"]);return Pe=function(){return e},e}function Ie(){var e=Object(Ee.a)(["\n        background: hsla(0, 0%, 100%, 0.4);\n      "]);return Ie=function(){return e},e}function Re(){var e=Object(Ee.a)(["\n      box-shadow: 0px 0px 10px #00ff00;\n      background: #19611c;\n    "]);return Re=function(){return e},e}function De(){var e=Object(Ee.a)(["\n  padding: 10px 15px;\n  margin: 5px;\n  color: #fff;\n  font-size: 15px;\n  border-radius: 3px;\n  background: hsla(0, 0%, 100%, 0.2);\n  ","\n\n  border: 1px solid hsl(210, 15%, 40%);\n  text-align: center;\n  cursor: pointer;\n\n  :hover {\n    ","\n  }\n"]);return De=function(){return e},e}function Te(){var e=Object(Ee.a)(["\n  display: flex;\n  justify-content: left;\n"]);return Te=function(){return e},e}function Be(){var e=Object(Ee.a)(["\n  color: #fff;\n  font-size: 15px;\n  margin: 12px 10px 5px 10px;\n  font-weight: bold;\n"]);return Be=function(){return e},e}function Le(){var e=Object(Ee.a)(["\n  position: absolute;\n  top: 20px;\n  left: 20px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  background: hsl(210, 25%, 20%);\n  border: 1px solid hsl(210, 15%, 40%);\n  opacity: 0.8;\n  color: #fff;\n  font-size: 25px;\n"]);return Le=function(){return e},e}function Fe(){var e=Object(Ee.a)(["\n  display: none;\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  background: hsl(210, 25%, 20%);\n  border: 1px solid hsl(210, 15%, 40%);\n  opacity: 0.8;\n  color: #fff;\n  pointer-events: none;\n"]);return Fe=function(){return e},e}var Ne=Ce.b.div(Fe()),ze=Ce.b.div(Le()),Ue=Ce.b.p(Be()),Ye=Ce.b.div(Te()),Xe=Ce.b.div(De(),function(e){return e.selected&&Object(Ce.a)(Re())},function(e){return!e.selected&&Object(Ce.a)(Ie())}),Ze=Ce.b.table(Pe()),He=Ce.b.main(Me(),Ne),We=function(e){function t(e){var n;return Object(h.a)(this,t),(n=Object(f.a)(this,Object(v.a)(t).call(this,e))).targetRef=i.a.createRef(),n.runtime=new ke(n.props.project),n.activeButtonRef=null,n.state={audioImplementation:z.WebAudio},n.onExit=function(){n.runtime.detach(),n.props.onExit()},n.onVisualToggle=function(){n.runtime.toggleRendering()},n.onChangeAudio=function(e,t){n.props.project.selectAudioImplementation(t),n.setState({audioImplementation:t})},n.state.audioImplementation=n.props.project.activeAudioImplementation,n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.targetRef.current&&(this.runtime.attach(this.targetRef.current),this.runtime.focus())}},{key:"componentWillUnmount",value:function(){this.runtime.detach()}},{key:"render",value:function(){var e=this,t=this.state.audioImplementation;return i.a.createElement(He,{ref:this.targetRef},i.a.createElement(ze,null,"Audio3D",i.a.createElement(Ue,null,"Menu"),i.a.createElement(Ye,null,i.a.createElement(Xe,{onClick:this.onExit},"Exit"),i.a.createElement(Xe,{onClick:this.onVisualToggle},"Toggle visuals")),i.a.createElement(Ue,null,"Audio implementation"),i.a.createElement(Ye,null,i.a.createElement(Xe,{onClick:function(t){return e.onChangeAudio(t,z.WebAudio)},selected:t===z.WebAudio},"Web Audio API"),i.a.createElement(Xe,{selected:t===z.Binaural,onClick:function(t){return e.onChangeAudio(t,z.Binaural)}},"BinauralFIR"),i.a.createElement(Xe,{selected:t===z.ResonanceAudio,onClick:function(t){return e.onChangeAudio(t,z.ResonanceAudio)}},"Resonance Audio")),i.a.createElement(Ue,null,"Controls"),i.a.createElement(Ze,null,i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,"Move"),i.a.createElement("td",null,"W/A/S/D or left stick")),i.a.createElement("tr",null,i.a.createElement("td",null,"View"),i.a.createElement("td",null,"Arrow keys or right stick")),i.a.createElement("tr",null,i.a.createElement("td",null,"Interact"),i.a.createElement("td",null,"E or A (XBOX)"))))),i.a.createElement(Ne,null,"Focused"))}}]),t}(i.a.Component);function Ge(){var e=Object(Ee.a)(["\n  display: block;\n  appearance: none;\n  border: none;\n  background: hsl(210, 29%, 20%);\n  color: #fff;\n  cursor: pointer;\n  border-radius: 3px;\n  padding: 8px 12px;\n  margin-left: 10px;\n  font-size: 0.9em;\n\n  transition: 0.2s background-color, 0.2s box-shadow;\n\n  :hover,\n  :active {\n    background: hsl(210, 29%, 35%);\n    box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);\n  }\n\n  :focus {\n    outline: none;\n    border-color: #3498db;\n  }\n\n  :disabled {\n    background: hsl(210, 19%, 20%);\n    color: hsl(210, 20%, 80%);\n    cursor: not-allowed;\n    box-shadow: none;\n  }\n"]);return Ge=function(){return e},e}function Ke(){var e=Object(Ee.a)(["\n  margin-top: 20px;\n  display: flex;\n  justify-content: flex-end;\n"]);return Ke=function(){return e},e}function _e(){var e=Object(Ee.a)(["\n  padding: 10px 15px;\n"]);return _e=function(){return e},e}function qe(){var e=Object(Ee.a)(["\n  padding: 10px 15px;\n  background: hsl(210, 29%, 15%);\n"]);return qe=function(){return e},e}function Ve(){var e=Object(Ee.a)(["\n  border-radius: 5px;\n  overflow: hidden;\n  max-width: 600px;\n  color: #fff;\n  background: hsl(210, 29%, 29%);\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n"]);return Ve=function(){return e},e}function Je(){var e=Object(Ee.a)(["\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 2;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]);return Je=function(){return e},e}var Qe=Ce.b.div(Je()),$e=Ce.b.div(Ve()),et=Ce.b.div(qe()),tt=Ce.b.div(_e()),nt=Ce.b.div(Ke()),at=Ce.b.button(Ge()),ot=function(e){function t(){var e,n;Object(h.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).onBackdropClick=function(e){e.currentTarget===e.target&&n.props.onDismiss&&n.props.onDismiss()},n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return i.a.createElement(Qe,{onClick:this.onBackdropClick},i.a.createElement($e,null,i.a.createElement(et,null,this.props.title),i.a.createElement(tt,null,this.props.children)))}}]),t}(i.a.Component),it=function(e){function t(){return Object(h.a)(this,t),Object(f.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props.audioEntry;return i.a.createElement(ot,{title:"Audio File",onDismiss:this.props.onDismiss},i.a.createElement("p",null,i.a.createElement("b",null,"ID:")," ",t.id),i.a.createElement("p",null,i.a.createElement("b",null,"Name:")," ",t.name),i.a.createElement("p",null,i.a.createElement("b",null,"Type:")," ",t.type),i.a.createElement("p",null,i.a.createElement("b",null,"Size:")," ",Math.ceil(t.data.byteLength/1024)," KiB"),i.a.createElement(nt,null,i.a.createElement(at,{onClick:function(){return e.props.onDelete(t)}},"Delete"),i.a.createElement(at,{onClick:function(){return e.props.onExport(t)}},"Export"),i.a.createElement(at,{onClick:this.props.onCancel},"Back")))}}]),t}(i.a.Component);function rt(){var e=Object(Ee.a)(["\n  flex: 1 1 150px;\n  margin: 5px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  cursor: pointer;\n  background: hsl(210, 29%, 20%);\n  transition: 0.2s background-color, 0.2s box-shadow;\n\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n\n  :hover,\n  :active {\n    background: hsl(210, 29%, 35%);\n    box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);\n  }\n"]);return rt=function(){return e},e}function ct(){var e=Object(Ee.a)(["\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  margin: 0 -5px;\n"]);return ct=function(){return e},e}var st=Ce.b.div(ct()),ut=Ce.b.div(rt()),lt=function(e){function t(){var e,n;Object(h.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).previewAudio=new Audio,n.state={entries:[],selectedEntry:null},n.openAudioFileDialog=Object(p.a)(d.a.mark(function e(){var t,a,o,i;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je({accept:"audio/*"});case 2:return t=e.sent,e.next=5,ye(t);case 5:return a=e.sent,o={name:t.name,type:t.type,data:a},e.next=9,n.props.audioLibrary.add(o);case 9:i=e.sent,n.setState(function(e){var t=e.entries;return{entries:[].concat(Object(u.a)(t),[Object(s.a)({id:i},o)])}});case 11:case"end":return e.stop()}},e,this)})),n.stopPreview=function(){n.previewAudio.pause(),URL.revokeObjectURL(n.previewAudio.src)},n.dismiss=function(){n.setState({selectedEntry:null}),n.props.onDismiss(),n.stopPreview()},n.unselectEntry=function(){n.setState({selectedEntry:null}),n.stopPreview()},n.deleteAudio=function(e){var t=e.id;n.props.audioLibrary.delete(t),n.setState(function(e){return{entries:e.entries.filter(function(e){return e.id!==t}),selectedEntry:null}})},n.exportAudio=function(e){var t=e.name,n=e.type,a=e.data;Object(x.saveAs)(new Blob([a],{type:n}),t)},n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"previewEntry",value:function(e){this.previewAudio.src=URL.createObjectURL(new Blob([e.data])),this.previewAudio.loop=!0,this.previewAudio.play()}},{key:"selectEntry",value:function(e){this.props.onSelect?this.props.onSelect(e):this.setState({selectedEntry:e})}},{key:"updateEntries",value:function(){var e=Object(p.a)(d.a.mark(function e(){var t,n,a,o,i,r,c,u,l,p,h;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,a=!1,e.prev=3,i=Object(w.a)(this.props.audioLibrary.entries());case 5:return e.next=7,i.next();case 7:return r=e.sent,n=r.done,e.next=11,r.value;case 11:if(c=e.sent,n){e.next=18;break}u=c,l=Object(y.a)(u,2),p=l[0],h=l[1],t.push(Object(s.a)({},h,{id:p}));case 15:n=!0,e.next=5;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(3),a=!0,o=e.t0;case 24:if(e.prev=24,e.prev=25,n||null==i.return){e.next=29;break}return e.next=29,i.return();case 29:if(e.prev=29,!a){e.next=32;break}throw o;case 32:return e.finish(29);case 33:return e.finish(24);case 34:this.setState({entries:t.sort(function(e,t){return e.id-t.id})});case 35:case"end":return e.stop()}},e,this,[[3,20,24,34],[25,,29,33]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(p.a)(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateEntries();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(p.a)(d.a.mark(function e(t){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.audioLibrary===this.props.audioLibrary){e.next=3;break}return e.next=3,this.updateEntries();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.previewAudio.pause(),URL.revokeObjectURL(this.previewAudio.src)}},{key:"render",value:function(){var e=this,t=this.state,n=t.entries,a=t.selectedEntry;return a?i.a.createElement(it,{audioEntry:a,onDelete:this.deleteAudio,onExport:this.exportAudio,onCancel:this.unselectEntry,onDismiss:this.dismiss}):i.a.createElement(ot,{title:this.props.onSelect?"Select Audio":"Audio Library",onDismiss:this.dismiss},i.a.createElement(st,null,n.length>0&&n.map(function(t){return i.a.createElement(ut,{key:t.id,title:t.name,onClick:function(){return e.selectEntry(t)},onMouseEnter:function(){return e.previewEntry(t)},onMouseLeave:e.stopPreview},t.name," ",i.a.createElement("br",null),t.type," ",i.a.createElement("br",null),Math.ceil(t.data.byteLength/1024)," KiB")})),!n.length&&i.a.createElement("div",null,"You haven't added any audio files yet"),i.a.createElement(nt,null,i.a.createElement(at,{onClick:this.openAudioFileDialog},"Add audio file"),i.a.createElement(at,{onClick:this.dismiss},"Cancel")))}}]),t}(i.a.Component);function dt(){var e=Object(Ee.a)(["\n  height: 0;\n  margin: 5px;\n  border-bottom: 1px solid hsl(210, 15%, 35%);\n"]);return dt=function(){return e},e}function pt(){var e=Object(Ee.a)(["\n  white-space: nowrap;\n  padding: 8px 20px;\n  margin: 2px 0;\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 29%, 15%);\n  }\n"]);return pt=function(){return e},e}function ht(){var e=Object(Ee.a)(["\n  z-index: 1;\n  position: absolute;\n  left: 0;\n  top: 100%;\n  background: hsl(210, 25%, 20%);\n  padding: 5px 0;\n  min-width: 200px;\n  font-size: 0.95em;\n  box-shadow: 5px 5px 8px rgba(0, 0, 0, 0.5);\n\n  border-bottom-left-radius: 3px;\n  border-bottom-right-radius: 3px;\n\n  cursor: default;\n"]);return ht=function(){return e},e}function mt(){var e=Object(Ee.a)(["\n  cursor: pointer;\n"]);return mt=function(){return e},e}function ft(){var e=Object(Ee.a)(["\n      float: right;\n    "]);return ft=function(){return e},e}function vt(){var e=Object(Ee.a)(["\n      background: hsl(210, 25%, 20%);\n    "]);return vt=function(){return e},e}function bt(){var e=Object(Ee.a)(["\n  position: relative;\n  display: inline-block;\n  padding: 10px 15px;\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 25%, 20%);\n  }\n\n  ","\n\n  ","\n"]);return bt=function(){return e},e}function jt(){var e=Object(Ee.a)(["\n  flex: 0 0 auto;\n  background: hsl(210, 29%, 15%);\n  color: #fff;\n  font-size: 0.9em;\n  padding: 0 10px;\n  user-select: none;\n\n  :focus {\n    outline: none;\n  }\n"]);return jt=function(){return e},e}var yt,wt=Ce.b.div(jt()),xt=Ce.b.div(bt(),function(e){return e.isActive&&Object(Ce.a)(vt())},function(e){return e.alignRight&&Object(Ce.a)(ft())}),gt=Ce.b.label(mt()),At=Ce.b.div(ht()),Ot=Ce.b.div(pt()),St=Ce.b.div(dt());!function(e){e[e.FileMenu=0]="FileMenu",e[e.EditMenu=1]="EditMenu",e[e.AudioMenu=2]="AudioMenu",e[e.ViewMenu=3]="ViewMenu",e[e.HelpMenu=4]="HelpMenu"}(yt||(yt={}));var kt=function(e){function t(){var e,n;Object(h.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).state={activeMenu:null},n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"toggleMenu",value:function(e){this.setState(function(t){return{activeMenu:t.activeMenu===e?null:e}})}},{key:"closeMenu",value:function(){this.setState({activeMenu:null})}},{key:"render",value:function(){var e=this,t=this.props,n=t.audioImplementation,a=t.onAudioChange,o=this.state.activeMenu;return i.a.createElement(wt,{tabIndex:-1,onBlur:function(){return e.closeMenu()}},i.a.createElement(xt,{isActive:o===yt.FileMenu,onClick:function(){return e.toggleMenu(yt.FileMenu)}},i.a.createElement(gt,null,"File"),i.a.createElement(At,{hidden:o!==yt.FileMenu},i.a.createElement(Ot,{onClick:this.props.onNewProject},"New project"),i.a.createElement(St,null),i.a.createElement(Ot,{onClick:this.props.onLoadProject},"Load project"),i.a.createElement(Ot,{onClick:this.props.onImportProject},"Import project"),i.a.createElement(St,null),i.a.createElement(Ot,{onClick:this.props.onSaveProject},"Save project"),i.a.createElement(Ot,{onClick:this.props.onExportProject},"Export project"),i.a.createElement(St,null),i.a.createElement(Ot,{onClick:this.props.onShowSettings},"Settings"))),i.a.createElement(xt,{isActive:o===yt.EditMenu,onClick:function(){return e.toggleMenu(yt.EditMenu)}},i.a.createElement(gt,null,"Edit"),i.a.createElement(At,{hidden:o!==yt.EditMenu},i.a.createElement(Ot,{onClick:this.props.onAddObject},"Add object"),i.a.createElement(Ot,{onClick:this.props.onDeleteObject},"Delete object"),i.a.createElement(St,null),i.a.createElement(Ot,{onClick:this.props.onAddSpawn},"Add spawn"),i.a.createElement(Ot,{onClick:this.props.onDeleteSpawn},"Delete spawn"),i.a.createElement(St,null),i.a.createElement(Ot,{onClick:this.props.onAddRoom},"Add room"),i.a.createElement(Ot,{onClick:this.props.onDeleteRoom},"Delete room"))),i.a.createElement(xt,{isActive:o===yt.ViewMenu,onClick:function(){return e.toggleMenu(yt.ViewMenu)}},i.a.createElement(gt,null,"View"),i.a.createElement(At,{hidden:o!==yt.ViewMenu},i.a.createElement(Ot,{onClick:this.props.onShowAudioLibrary},"Audio Library"),i.a.createElement(Ot,{onClick:this.props.onShowProjectManager},"Project Manager"))),i.a.createElement(xt,{isActive:o===yt.HelpMenu,onClick:function(){return e.toggleMenu(yt.HelpMenu)}},i.a.createElement(gt,null,"Help"),i.a.createElement(At,{hidden:o!==yt.HelpMenu},i.a.createElement(Ot,{onClick:function(){return window.open("https://github.com/niklaskorz/audio3d/wiki/Code-Blocks","_blank")}},"How to use Code Blocks"),i.a.createElement(St,null),i.a.createElement(Ot,{onClick:function(){return window.open("https://github.com/niklaskorz/audio3d/issues","_blank")}},"Issues"),i.a.createElement(Ot,{onClick:function(){return window.open("https://github.com/niklaskorz/audio3d","_blank")}},"Source Code"),i.a.createElement(St,null),i.a.createElement(Ot,{onClick:function(){return window.open("https://github.com/niklaskorz/audio3d/blob/master/README.md","_blank")}},"About"))),i.a.createElement(xt,{alignRight:!0,onClick:this.props.onRunProject},i.a.createElement(gt,null,"Run")),i.a.createElement(xt,{alignRight:!0,isActive:o===yt.AudioMenu,onClick:function(){return e.toggleMenu(yt.AudioMenu)}},i.a.createElement(gt,null,"Audio: ",n),i.a.createElement(At,{hidden:o!==yt.AudioMenu},i.a.createElement(Ot,{onClick:function(){return a(z.WebAudio)}},z.WebAudio),i.a.createElement(Ot,{onClick:function(){return a(z.Binaural)}},z.Binaural),i.a.createElement(Ot,{onClick:function(){return a(z.ResonanceAudio)}},z.ResonanceAudio))))}}]),t}(i.a.Component),Et=function(e){e.currentTarget.select()};function Ct(){var e=Object(Ee.a)(["\n      background: hsl(210, 29%, 20%);\n      border-left: 2px solid #3498db;\n    "]);return Ct=function(){return e},e}function Mt(){var e=Object(Ee.a)(["\n  cursor: pointer;\n  padding: 7px 10px;\n  border-radius: 2px;\n  ",";\n"]);return Mt=function(){return e},e}function Pt(){var e=Object(Ee.a)(["\n  list-style: none;\n  padding: 5px;\n  margin: 5px 0;\n  border-radius: 3px;\n  background: hsl(210, 29%, 24%);\n"]);return Pt=function(){return e},e}function It(){var e=Object(Ee.a)(["\n  display: flex;\n  flex-direction: row;\n\n  > "," {\n    flex: 1;\n    width: auto;\n    min-width: 0;\n\n    margin-right: 5px;\n\n    :last-child {\n      margin-right: 0;\n    }\n  }\n"]);return It=function(){return e},e}function Rt(){var e=Object(Ee.a)(['\n  min-height: 200px;\n  font-family: "Fira Code Retina", "Fira Code", Consolas, Menlo, Monaco,\n    monospace;\n  white-space: pre;\n  line-height: 1.5;\n\n  /* Disable user resizing of width */\n  min-width: 100%;\n  max-width: 100%;\n']);return Rt=function(){return e},e}function Dt(){var e=Object(Ee.a)(["\n  cursor: pointer;\n"]);return Dt=function(){return e},e}function Tt(){var e=Object(Ee.a)(["\n  cursor: pointer;\n"]);return Tt=function(){return e},e}function Bt(){var e=Object(Ee.a)(['\n  display: block;\n  background: hsl(210, 29%, 24%);\n  border-radius: 0.2em;\n  border: 0.15em solid hsl(210, 29%, 24%);\n  color: #fff;\n  width: 100%;\n  padding: 0.7em 0.85em;\n  margin: 0.35em 0;\n\n  :not([type="range"]) {\n    appearance: none;\n  }\n\n  transition: 0.2s ease border-color;\n  :focus {\n    outline: none;\n    border-color: #3498db;\n  }\n']);return Bt=function(){return e},e}function Lt(){var e=Object(Ee.a)(["\n  font-size: 0.9em;\n  color: hsl(210, 20%, 90%);\n"]);return Lt=function(){return e},e}function Ft(){var e=Object(Ee.a)(["\n  font-weight: bold;\n"]);return Ft=function(){return e},e}function Nt(){var e=Object(Ee.a)(["\n  margin: 0;\n  margin-bottom: 1.4em;\n\n  & > & {\n    margin-top: 1.4em;\n    font-size: 0.9em;\n  }\n"]);return Nt=function(){return e},e}function zt(){var e=Object(Ee.a)(["\n  font-size: 0.9em;\n  flex: 0 0 300px;\n  height: 100%;\n  background: hsl(210, 29%, 29%);\n  color: #fff;\n  padding: 0 15px;\n  padding-top: 1.4em;\n  overflow-x: hidden;\n  overflow-y: auto;\n"]);return zt=function(){return e},e}function Ut(){var e=Object(Ee.a)(["\n  position: relative;\n  flex: 1;\n  height: 100%;\n\n  :focus-within > "," {\n    display: block;\n  }\n"]);return Ut=function(){return e},e}function Yt(){var e=Object(Ee.a)(["\n  display: none;\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  background: hsl(210, 25%, 20%);\n  border: 1px solid hsl(210, 15%, 40%);\n  opacity: 0.8;\n  color: #fff;\n  pointer-events: none;\n"]);return Yt=function(){return e},e}function Xt(){var e=Object(Ee.a)(["\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: row;\n"]);return Xt=function(){return e},e}function Zt(){var e=Object(Ee.a)(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background: #000;\n  display: flex;\n  flex-direction: column;\n"]);return Zt=function(){return e},e}var Ht,Wt,Gt=Ce.b.div(Zt()),Kt=Ce.b.div(Xt()),_t=Ce.b.div(Yt()),qt=Ce.b.main(Ut(),_t),Vt=Ce.b.aside(zt()),Jt=Ce.b.div(Nt()),Qt=Ce.b.label(Ft()),$t=Ce.b.p(Lt()),en=Ce.b.input(Bt()),tn=Object(Ce.b)(en.withComponent("select"))(Tt()),nn=Object(Ce.b)(en.withComponent("div"))(Dt()),an=Object(Ce.b)(en.withComponent("textarea"))(Rt()),on=Ce.b.div(It(),en),rn=Ce.b.ol(Pt()),cn=Ce.b.li(Mt(),function(e){return e.active&&Object(Ce.a)(Ct())}),sn=function(e){function t(){var e,n;Object(h.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).codeCheckTimeout=null,n.state={volume:1},n.checkCode=function(){var e=n.props.object.codeBlockSource;if(null!=e)try{new Function("playerState","roomState",e),n.setState({codeError:void 0})}catch(t){n.setState({codeError:t.toString()})}},n.updateCodeBlockSource=function(e){n.props.onUpdateCodeBlockSource(e.currentTarget.value),null!=n.codeCheckTimeout&&window.clearTimeout(n.codeCheckTimeout),n.codeCheckTimeout=window.setTimeout(n.checkCode,2e3)},n.updateTeleportTargetRoomId=function(e){var t=e.currentTarget.value;n.props.onUpdateTeleportTarget({roomId:t,spawnId:""})},n.updateTeleportTargetSpawnId=function(e){var t=n.props,a=t.object,o=t.onUpdateTeleportTarget;if(a.teleportTarget){var i=e.currentTarget.value;o(Object(s.a)({},a.teleportTarget,{spawnId:i}))}},n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.checkCode()}},{key:"componentWillUnmount",value:function(){null!=this.codeCheckTimeout&&(window.clearTimeout(this.codeCheckTimeout),this.codeCheckTimeout=null)}},{key:"render",value:function(){var e=this.props,t=e.object,n=e.rooms,a=e.onUpdateName,o=e.onUpdatePosition,r=e.onUpdateRotation,c=e.onUpdateVolume,s=e.onUpdateScale,u=e.onUpdateInteractionType,l=e.onShowAudioSelection,d=e.onShowInteractionAudioSelection,p=this.state.codeError,h=t.teleportTarget&&n.find(function(e){return e.uuid===t.teleportTarget.roomId});return i.a.createElement("div",null,i.a.createElement(Jt,null,i.a.createElement("label",null,"Object ID"),i.a.createElement(en,{type:"text",readOnly:!0,value:t.uuid,onFocus:Et})),i.a.createElement(Jt,null,i.a.createElement("label",null,"Name"),i.a.createElement(en,{type:"text",placeholder:"New object",value:t.name,onChange:function(e){return a(e.currentTarget.value)}})),i.a.createElement(Jt,null,i.a.createElement("label",null,"Position (x, y, z)"),i.a.createElement(on,null,i.a.createElement(en,{type:"number",step:.01,value:t.position.x.toFixed(2),onChange:function(e){return o(Q(e.currentTarget.valueAsNumber,.01),t.position.y,t.position.z)}}),i.a.createElement(en,{type:"number",step:.01,value:t.position.y.toFixed(2),onChange:function(e){return o(t.position.x,Q(e.currentTarget.valueAsNumber,.01),t.position.z)}}),i.a.createElement(en,{type:"number",step:.01,value:t.position.z.toFixed(2),onChange:function(e){return o(t.position.x,t.position.y,Q(e.currentTarget.valueAsNumber,.01))}}))),i.a.createElement(Jt,null,i.a.createElement("label",null,"Euler-Rotation in Degrees (x, y, z)"),i.a.createElement(on,null,i.a.createElement(en,{type:"number",step:1,value:V(t.rotation.x).toFixed(0),onChange:function(e){return r(J(e.currentTarget.valueAsNumber%360),t.rotation.y,t.rotation.z)}}),i.a.createElement(en,{type:"number",step:1,value:V(t.rotation.y).toFixed(0),onChange:function(e){return r(t.rotation.x,J(e.currentTarget.valueAsNumber%360),t.rotation.z)}}),i.a.createElement(en,{type:"number",step:1,value:V(t.rotation.z).toFixed(0),onChange:function(e){return r(t.rotation.x,t.rotation.y,J(e.currentTarget.valueAsNumber%360))}}))),i.a.createElement(Jt,null,i.a.createElement("label",null,"Size (width, height, depth)"),i.a.createElement(on,null,i.a.createElement(en,{type:"number",step:.1,min:.1,max:10,value:t.scale.x.toFixed(1),onChange:function(e){return s(e.currentTarget.valueAsNumber,t.scale.y,t.scale.z)}}),i.a.createElement(en,{type:"number",step:.1,min:.1,max:10,value:t.scale.y.toFixed(1),onChange:function(e){return s(t.scale.x,e.currentTarget.valueAsNumber,t.scale.z)}}),i.a.createElement(en,{type:"number",step:.1,min:.1,max:10,value:t.scale.z.toFixed(1),onChange:function(e){return s(t.scale.x,t.scale.y,e.currentTarget.valueAsNumber)}}))),i.a.createElement(Jt,null,i.a.createElement("label",null,"Audio"),i.a.createElement(nn,{onClick:l},t.audio?"".concat(t.audio.name," (").concat(Math.ceil(t.audio.data.byteLength/1024)," KiB)"):"No audio selected"),null!=t.audio&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Jt,null,i.a.createElement("label",null,"Loop Pause (seconds)"),i.a.createElement(en,{type:"number",min:"0",max:"60",step:"1"})),i.a.createElement(Jt,null,i.a.createElement("label",null,"Volume (0% to 200%)"),i.a.createElement(en,{type:"range",min:"0",max:"2",step:"0.05",value:t.volume,onChange:function(e){return c(e.currentTarget.valueAsNumber)}})))),i.a.createElement(Jt,null,i.a.createElement("label",null,"Interaction"),i.a.createElement(tn,{value:t.interactionType,onChange:function(e){return u(e.currentTarget.value)}},Object.values(X).map(function(e){return i.a.createElement("option",{key:e},e)})),t.interactionType===X.CodeBlock&&i.a.createElement(i.a.Fragment,null,i.a.createElement(an,{placeholder:"// JavaScript",value:t.codeBlockSource,onChange:this.updateCodeBlockSource}),i.a.createElement($t,null,p||"No syntax errors detected")),t.interactionType===X.Teleport&&t.teleportTarget&&i.a.createElement(Jt,null,i.a.createElement("label",null,"Teleport Target"),i.a.createElement(tn,{value:t.teleportTarget.roomId,onChange:this.updateTeleportTargetRoomId},n.map(function(e){return i.a.createElement("option",{key:e.uuid,value:e.uuid},e.name||"Anonymous Room")})),h&&i.a.createElement(tn,{value:t.teleportTarget.spawnId,onChange:this.updateTeleportTargetSpawnId},h.spawns.map(function(e){return i.a.createElement("option",{key:e.uuid,value:e.uuid},e.name||"New spawn")}))),t.interactionType!==X.None&&t.interactionType!==X.CodeBlock&&i.a.createElement(Jt,null,i.a.createElement("label",null,"Interaction Sound"),i.a.createElement(nn,{onClick:d},t.interactionAudio?"".concat(t.interactionAudio.name," (").concat(Math.ceil(t.interactionAudio.data.byteLength/1024)," KiB)"):"No audio selected"))))}}]),t}(i.a.Component);!function(e){e[e.Normal=0]="Normal",e[e.RestrictedXZ=1]="RestrictedXZ"}(Ht||(Ht={})),function(e){e[e.AxisX=0]="AxisX",e[e.AxisY=1]="AxisY",e[e.AxisZ=2]="AxisZ",e[e.PlaneYZ=3]="PlaneYZ",e[e.PlaneXZ=4]="PlaneXZ",e[e.PlaneXY=5]="PlaneXY"}(Wt||(Wt={}));var un,ln=function(e){function t(e){var n;Object(h.a)(this,t),(n=Object(f.a)(this,Object(v.a)(t).call(this))).project=void 0,n.objectDragDirection=null,n.isScaling=!1,n.dragOffset=new j.v,n.lastPoint=new j.v,n.plane=new j.n,n.axisX=void 0,n.axisY=void 0,n.axisZ=void 0,n.scaleX=void 0,n.scaleY=void 0,n.scaleZ=void 0,n.planeYZ=void 0,n.planeXZ=void 0,n.planeXY=void 0,n.project=e;var a={transparent:!0,opacity:.75,side:j.f},o=new j.d(.05,.05,.5);n.axisX=new j.i(o,new j.j(Object(s.a)({},a,{color:16711680}))),n.axisX.position.set(.275,0,0),n.axisX.rotation.y=Math.PI/2,n.axisX.userData.direction=Wt.AxisX,n.axisY=new j.i(o,new j.j(Object(s.a)({},a,{color:65280}))),n.axisY.position.set(0,.275,0),n.axisY.rotation.x=Math.PI/2,n.axisY.userData.direction=Wt.AxisY,n.axisZ=new j.i(o,new j.j(Object(s.a)({},a,{color:255}))),n.axisZ.position.set(0,0,.275),n.axisZ.userData.direction=Wt.AxisZ,n.add(n.axisX),n.add(n.axisY),n.add(n.axisZ);var i=new j.t(.05,16,16);n.scaleX=new j.i(i,new j.j(Object(s.a)({},a,{color:16711680}))),n.scaleX.position.set(.65,0,0),n.scaleX.userData.direction=Wt.AxisX,n.scaleX.userData.isScale=!0,n.scaleY=new j.i(i,new j.j(Object(s.a)({},a,{color:65280}))),n.scaleY.position.set(0,.65,0),n.scaleY.userData.direction=Wt.AxisY,n.scaleY.userData.isScale=!0,n.scaleZ=new j.i(i,new j.j(Object(s.a)({},a,{color:255}))),n.scaleZ.position.set(0,0,.65),n.scaleZ.userData.direction=Wt.AxisZ,n.scaleZ.userData.isScale=!0,n.add(n.scaleX),n.add(n.scaleY),n.add(n.scaleZ);var r=new j.o(.25,.25);return n.planeYZ=new j.i(r,new j.j(Object(s.a)({},a,{color:65535}))),n.planeYZ.position.set(0,.25,.25),n.planeYZ.rotation.y=Math.PI/2,n.planeYZ.userData.direction=Wt.PlaneYZ,n.planeXZ=new j.i(r,new j.j(Object(s.a)({},a,{color:16711935}))),n.planeXZ.position.set(.25,0,.25),n.planeXZ.rotation.x=Math.PI/2,n.planeXZ.userData.direction=Wt.PlaneXZ,n.planeXY=new j.i(r,new j.j(Object(s.a)({},a,{color:16776960}))),n.planeXY.position.set(.25,.25,0),n.planeXY.userData.direction=Wt.PlaneXY,n.add(n.planeYZ),n.add(n.planeXZ),n.add(n.planeXY),n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"setMode",value:function(e){e===Ht.RestrictedXZ?(this.axisY.visible=!1,this.planeXY.visible=!1,this.planeYZ.visible=!1,this.scaleX.visible=!1,this.scaleY.visible=!1,this.scaleZ.visible=!1):(this.axisY.visible=!0,this.planeXY.visible=!0,this.planeYZ.visible=!0,this.scaleX.visible=!0,this.scaleY.visible=!0,this.scaleZ.visible=!0)}},{key:"getControlFromRaycaster",value:function(e){var t=this.project.activeObject||this.project.activeSpawn;if(!t)return null;this.position.copy(t.position);var n=e.intersectObjects(this.children),a=!0,o=!1,i=void 0;try{for(var r,c=n[Symbol.iterator]();!(a=(r=c.next()).done);a=!0){var s=r.value,u=s.object;if(u.userData.hasOwnProperty("direction"))return this.dragOffset.copy(s.point).sub(t.position),this.lastPoint.copy(s.point),u}}catch(l){o=!0,i=l}finally{try{a||null==c.return||c.return()}finally{if(o)throw i}}return null}},{key:"onClick",value:function(e){var t=this.getControlFromRaycaster(e);return!(!t||!t.userData.hasOwnProperty("direction"))&&(this.objectDragDirection=t.userData.direction,this.isScaling=!!t.userData.isScale,this.onMove(e),!0)}},{key:"onMove",value:function(e){var t=e.ray,n=this.project.activeObject||this.project.activeSpawn;if(null!==this.objectDragDirection&&n){var a=n.position,o=this.plane,i=null;switch(this.objectDragDirection){case Wt.AxisX:o.set(new j.v(0,1,0),-a.y),i=new j.n(new j.v(0,0,1),-a.z);break;case Wt.AxisY:o.set(new j.v(1,0,0),-a.x),i=new j.n(new j.v(0,0,1),-a.z);break;case Wt.AxisZ:o.set(new j.v(1,0,0),-a.x),i=new j.n(new j.v(0,1,0),-a.y);break;case Wt.PlaneXY:o.set(new j.v(0,0,1),-a.z);break;case Wt.PlaneYZ:o.set(new j.v(1,0,0),-a.x);break;case Wt.PlaneXZ:o.set(new j.v(0,1,0),-a.y)}i&&Math.abs(i.distanceToPoint(t.origin))>Math.abs(o.distanceToPoint(t.origin))&&o.copy(i);var r=t.intersectPlane(o,new j.v);if(r){if(this.isScaling){switch(this.objectDragDirection){case Wt.AxisX:n.scale.x=Math.min(Math.max(n.scale.x+(r.x-this.lastPoint.x),.1),10);break;case Wt.AxisY:n.scale.y=Math.min(Math.max(n.scale.y+(r.y-this.lastPoint.y),.1),10);break;case Wt.AxisZ:n.scale.z=Math.min(Math.max(n.scale.z+(r.z-this.lastPoint.z),.1),10)}this.project.events.onScale(n.scale)}else{switch(r.sub(this.dragOffset),this.objectDragDirection){case Wt.AxisX:n.position.x=r.x;break;case Wt.AxisY:n.position.y=r.y;break;case Wt.AxisZ:n.position.z=r.z;break;default:n.position.copy(r)}this.project.events.onTranslate(n.position)}this.lastPoint.copy(r)}}}}]),t}(j.s);!function(e){e[e.Primary=0]="Primary",e[e.Middle=1]="Middle",e[e.Secondary=2]="Secondary"}(un||(un={}));var dn={x:new j.v(1,0,0),y:new j.v(0,1,0),z:new j.v(0,0,1)},pn=function(){function e(t){var n=this;Object(h.a)(this,e),this.target=void 0,this.project=void 0,this.rafHandle=0,this.previousTimestamp=0,this.controls=void 0,this.renderer=new j.w,this.canvas=void 0,this.outlineMesh=new j.i,this.raycaster=new j.r,this.keys=new Oe(this.renderer.domElement),this.gamepads=new ge,this.isDraggingCamera=!1,this.resize=function(){if(n.target){var e=n.target,t=e.offsetWidth,a=e.offsetHeight;n.project.camera.aspect=t/a,n.project.camera.updateProjectionMatrix(),n.renderer.setPixelRatio(window.devicePixelRatio),n.renderer.setSize(t,a)}},this.animate=function(e){n.rafHandle=window.requestAnimationFrame(n.animate);var t=(e-n.previousTimestamp)/1e3;n.previousTimestamp=e,n.update(t),n.renderer.clear(),n.renderer.render(n.project.activeRoom,n.project.camera),(n.project.activeObject||n.project.activeSpawn)&&(n.project.activeObject?(n.controls.setMode(Ht.Normal),n.controls.position.copy(n.project.activeObject.position)):n.project.activeSpawn&&(n.controls.setMode(Ht.RestrictedXZ),n.controls.position.copy(n.project.activeSpawn.position)),n.renderer.clearDepth(),n.renderer.render(n.controls,n.project.camera))},this.onMouseDown=function(e){e.button===un.Secondary&&(n.isDraggingCamera=!0,n.canvas.requestPointerLock()),e.button===un.Primary&&(n.updateRaycaster(e),n.controls.onClick(n.raycaster)?n.canvas.style.cursor="grabbing":n.checkSceneClick(n.raycaster))},this.onMouseUp=function(e){e.button===un.Secondary&&n.isDraggingCamera&&(n.isDraggingCamera=!1,document.exitPointerLock()),e.button===un.Primary&&null!==n.controls.objectDragDirection&&(n.controls.objectDragDirection=null,n.controls.getControlFromRaycaster(n.raycaster)?n.canvas.style.cursor="grab":n.canvas.style.cursor=null)},this.onMouseMove=function(e){n.isDraggingCamera?(e.movementX&&n.project.camera.rotateOnWorldAxis(dn.y,-e.movementX/100),e.movementY&&n.project.camera.rotateOnAxis(dn.x,-e.movementY/100)):(n.updateRaycaster(e),null!==n.controls.objectDragDirection?n.controls.onMove(n.raycaster):n.controls.getControlFromRaycaster(n.raycaster)?n.canvas.style.cursor="grab":n.canvas.style.cursor=null)},this.onWheel=function(e){e.preventDefault();var t=e.deltaY;0===e.deltaMode&&(t/=15),n.project.camera.translateZ(t/10)},this.project=t,this.renderer.autoClear=!1,this.renderer.setClearColor(new j.e(1649238)),this.canvas=this.renderer.domElement,this.canvas.tabIndex=-1,this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("wheel",this.onWheel),this.canvas.addEventListener("contextmenu",function(e){return e.preventDefault(),e.stopPropagation(),!1},!0),this.controls=new ln(t)}return Object(m.a)(e,[{key:"attach",value:function(e){this.keys.listen(),this.gamepads.listen(),this.target=e,e.appendChild(this.canvas),this.resize(),window.requestAnimationFrame(this.animate),window.addEventListener("resize",this.resize)}},{key:"detach",value:function(){window.cancelAnimationFrame(this.rafHandle),window.removeEventListener("resize",this.resize),this.target&&(this.target.removeChild(this.canvas),delete this.target),this.keys.stop(),this.gamepads.stop()}},{key:"focus",value:function(){this.canvas.focus()}},{key:"changeProject",value:function(e){this.project=e,this.controls.project=e,this.resize()}},{key:"update",value:function(e){var t=this.project.camera;this.keys.isPressed("w")&&t.translateOnAxis(dn.z,-2*e),this.keys.isPressed("s")&&t.translateOnAxis(dn.z,2*e),this.keys.isPressed("a")&&t.translateOnAxis(dn.x,-2*e),this.keys.isPressed("d")&&t.translateOnAxis(dn.x,2*e),this.keys.isPressed(" ")&&(t.position.y+=2*e),this.keys.isPressed("Shift")&&(t.position.y-=2*e),this.keys.isPressed("ArrowLeft")&&t.rotateOnWorldAxis(dn.y,e),this.keys.isPressed("ArrowRight")&&t.rotateOnWorldAxis(dn.y,-e),this.keys.isPressed("ArrowUp")&&t.rotateOnAxis(dn.x,e),this.keys.isPressed("ArrowDown")&&t.rotateOnAxis(dn.x,-e);var n=this.gamepads.getAxis(0),a=this.gamepads.getAxis(1),o=this.gamepads.getAxis(2),i=this.gamepads.getAxis(3),r=this.gamepads.getAxis(4);n&&t.translateOnAxis(dn.x,2*e*n),a&&t.translateOnAxis(dn.z,2*e*a),r&&t.translateOnAxis(dn.y,2*e*r),o&&t.rotateOnWorldAxis(dn.y,-e*o),i&&t.rotateOnAxis(dn.x,-e*i)}},{key:"checkSceneClick",value:function(e){var t=e.intersectObjects(this.project.activeRoom.children),n=!0,a=!1,o=void 0;try{for(var i,r=t[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var c=i.value.object;if(c instanceof de)return this.project.selectSpawn(c),!0;if(c instanceof K)return this.project.selectObject(c),!0}}catch(s){a=!0,o=s}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}return this.project.unselect(),!1}},{key:"updateRaycaster",value:function(e){var t=this.renderer.getSize(new j.u),n=(e.pageX-this.target.offsetLeft)/t.x*2-1,a=-(e.pageY-this.target.offsetTop)/t.y*2+1;this.raycaster.setFromCamera({x:n,y:a},this.project.camera)}}]),e}(),hn=n(32),mn=Object.keys(k.ResonanceAudio.Utils.ROOM_MATERIAL_COEFFICIENTS),fn=function(e){function t(){return Object(h.a)(this,t),Object(f.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(m.a)(t,[{key:"selectMaterialHandler",value:function(e){var t=this;return function(n){var a=t.props,o=a.room;(0,a.onUpdateMaterials)(Object(s.a)({},o.materials,Object(hn.a)({},e,n.currentTarget.value)))}}},{key:"render",value:function(){var e=this.props,t=e.room,n=e.onUpdateName,a=e.onUpdateDimensions,o=mn.map(function(e){return i.a.createElement("option",{key:e},e)});return i.a.createElement("div",null,i.a.createElement(Jt,null,i.a.createElement("label",null,"Room ID"),i.a.createElement(en,{type:"text",readOnly:!0,value:t.uuid,onFocus:Et})),i.a.createElement(Jt,null,i.a.createElement("label",null,"Name"),i.a.createElement(en,{type:"text",placeholder:"Anonymous Room",value:t.name,onChange:function(e){return n(e.currentTarget.value)}})),i.a.createElement(Jt,null,i.a.createElement("label",null,"Dimensions (width, depth, height)"),i.a.createElement(on,null,i.a.createElement(en,{type:"number",step:1,min:5,max:50,value:t.dimensions.width,onChange:function(e){return a(Object(s.a)({},t.dimensions,{width:Math.round(e.currentTarget.valueAsNumber)}))}}),i.a.createElement(en,{type:"number",step:1,min:5,max:50,value:t.dimensions.depth,onChange:function(e){return a(Object(s.a)({},t.dimensions,{depth:Math.round(e.currentTarget.valueAsNumber)}))}}),i.a.createElement(en,{type:"number",step:1,min:2,max:10,value:t.dimensions.height,onChange:function(e){return a(Object(s.a)({},t.dimensions,{height:Math.round(e.currentTarget.valueAsNumber)}))}}))),i.a.createElement(Jt,null,i.a.createElement("label",null,"Room Materials"),i.a.createElement($t,null,"These materials are used for calculating resonance (reverb) in the room. Only supported when using Resonance Audio."),i.a.createElement(Jt,null,i.a.createElement("label",null,"Left wall"),i.a.createElement(tn,{value:t.materials.left,onChange:this.selectMaterialHandler("left")},o)),i.a.createElement(Jt,null,i.a.createElement("label",null,"Right wall"),i.a.createElement(tn,{value:t.materials.right,onChange:this.selectMaterialHandler("right")},o)),i.a.createElement(Jt,null,i.a.createElement("label",null,"Front wall"),i.a.createElement(tn,{value:t.materials.front,onChange:this.selectMaterialHandler("front")},o)),i.a.createElement(Jt,null,i.a.createElement("label",null,"Back wall"),i.a.createElement(tn,{value:t.materials.back,onChange:this.selectMaterialHandler("back")},o)),i.a.createElement(Jt,null,i.a.createElement("label",null,"Floor"),i.a.createElement(tn,{value:t.materials.down,onChange:this.selectMaterialHandler("down")},o)),i.a.createElement(Jt,null,i.a.createElement("label",null,"Ceiling"),i.a.createElement(tn,{value:t.materials.up,onChange:this.selectMaterialHandler("up")},o))))}}]),t}(i.a.Component),vn=function(e){function t(){return Object(h.a)(this,t),Object(f.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props.project;return i.a.createElement(ot,{title:"Project Info",onDismiss:this.props.onDismiss},i.a.createElement("p",null,i.a.createElement("b",null,"Name:")," ",t.name),i.a.createElement("p",null,i.a.createElement("b",null,"Last update:")," ",t.savedAt.toLocaleString()),i.a.createElement("p",null,i.a.createElement("b",null,"Rooms:")," ",t.rooms.length),i.a.createElement(nt,null,i.a.createElement(at,{onClick:function(){return e.props.onDelete(t)}},"Delete"),i.a.createElement(at,{onClick:function(){return e.props.onExport(t)}},"Export"),i.a.createElement(at,{onClick:this.props.onCancel},"Back")))}}]),t}(i.a.Component);function bn(){var e=Object(Ee.a)(["\n  padding: 5px 10px;\n"]);return bn=function(){return e},e}function jn(){var e=Object(Ee.a)(["\n  padding: 5px 10px;\n"]);return jn=function(){return e},e}function yn(){var e=Object(Ee.a)(["\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 29%, 40%);\n  }\n"]);return yn=function(){return e},e}function wn(){var e=Object(Ee.a)(["\n  text-align: left;\n"]);return wn=function(){return e},e}function xn(){var e=Object(Ee.a)(["\n  width: 100%;\n"]);return xn=function(){return e},e}function gn(){var e=Object(Ee.a)(["\n  border: 2px solid hsl(210, 29%, 20%);\n  border-radius: 3px;\n  max-height: 400px;\n  min-width: 500px;\n  overflow-y: auto;\n  padding-bottom: 5px;\n"]);return gn=function(){return e},e}var An=Ce.b.div(gn()),On=Ce.b.table(xn()),Sn=Ce.b.thead(wn()),kn=Ce.b.tr(yn()),En=Ce.b.th(jn()),Cn=Ce.b.td(bn()),Mn=function(e){function t(){var e,n;Object(h.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).state={projects:[],selectedProject:null},n.dismiss=function(){n.setState({selectedProject:null}),n.props.onDismiss()},n.unselectProject=function(){n.setState({selectedProject:null})},n.deleteProject=function(e){var t=e.id;t&&(R(t),n.setState(function(e){return{projects:e.projects.filter(function(e){return e.id!==t}),selectedProject:null}}))},n.exportProject=function(e){var t=(new be).fromData(e,e.id);S(t)},n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"selectProject",value:function(e){this.props.onSelectProject?this.props.onSelectProject(e):this.setState({selectedProject:e})}},{key:"componentDidMount",value:function(){var e=Object(p.a)(d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:t=e.sent,this.setState({projects:t.reverse()});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.projects,a=t.selectedProject;return a?i.a.createElement(vn,{project:a,onDelete:this.deleteProject,onExport:this.exportProject,onCancel:this.unselectProject,onDismiss:this.dismiss}):i.a.createElement(ot,{title:this.props.onSelectProject?"Load Project":"Project Manager",onDismiss:this.dismiss},n.length>0&&i.a.createElement(An,null,i.a.createElement(On,null,i.a.createElement(Sn,null,i.a.createElement("tr",null,i.a.createElement(En,null,"ID"),i.a.createElement(En,null,"Name"),i.a.createElement(En,null,"Rooms"),i.a.createElement(En,null,"Last update"))),i.a.createElement("tbody",null,n.map(function(t){return i.a.createElement(kn,{key:t.id,onClick:function(){return e.selectProject(t)}},i.a.createElement(Cn,null,t.id),i.a.createElement(Cn,null,t.name),i.a.createElement(Cn,null,t.rooms.length),i.a.createElement(Cn,null,t.savedAt.toLocaleString()))})))),!n.length&&i.a.createElement("p",null,"You don't have any saved projects yet"),i.a.createElement(nt,null,i.a.createElement(at,{onClick:this.props.onNewProject},"New project"),i.a.createElement(at,{onClick:this.dismiss},"Cancel")))}}]),t}(i.a.Component);function Pn(){var e=Object(Ee.a)(["\n  overflow: auto;\n  max-height: 400px;\n  min-width: 500px;\n  /* Add some space between content and scrollbar */\n  padding: 0 10px;\n  margin: 0 -10px;\n"]);return Pn=function(){return e},e}var In,Rn=Ce.b.div(Pn());!function(e){e[e.Footstep=0]="Footstep",e[e.Collision=1]="Collision",e[e.InteractAvail=2]="InteractAvail"}(In||(In={}));var Dn,Tn,Bn=function(e){function t(){var e,n;Object(h.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).state={panningModel:"equalpower",distanceModel:"inverse",ambisonicOrder:1,rollofModel:"logarithmic"},n.onProjectNameChanged=function(e){var t=e.currentTarget.value;t&&(n.props.project.name=t),n.setState({projectName:t})},n.hideAudioSelection=function(){n.setState({audioSelectionTarget:void 0})},n.selectAudio=function(e){var t=n.props.project;switch(n.state.audioSelectionTarget){case In.Footstep:t.setFootstepAudio(e.id),n.setState({footstepAudio:e});break;case In.Collision:t.setCollisionAudio(e.id),n.setState({collisionAudio:e});break;case In.InteractAvail:t.setInteractAvailAudio(e.id),n.setState({interactAvailAudio:e})}n.hideAudioSelection()},n.selectPanningModel=function(e){var t=n.props.project,a=e.currentTarget.value;t.selectPanningModel(a),n.setState({panningModel:a})},n.selectDistanceModel=function(e){var t=n.props.project,a=e.currentTarget.value;t.selectDistanceModel(a),n.setState({distanceModel:a})},n.selectAmbisonicOrder=function(e){var t=n.props.project,a=parseInt(e.currentTarget.value);t.selectAmbisonicOrder(a),n.setState({ambisonicOrder:a})},n.selectRollofModel=function(e){var t=n.props.project,a=e.currentTarget.value;t.selectRollofModel(a),n.setState({rollofModel:a})},n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.onProjectChanged()}},{key:"componentDidUpdate",value:function(e){e.project!==this.props.project&&this.onProjectChanged()}},{key:"onProjectChanged",value:function(){var e=this.props.project;this.setState({panningModel:e.panningModel,rollofModel:e.rollofModel,distanceModel:e.distanceModel,ambisonicOrder:e.ambisonicOrder,projectName:null!=e.id?e.name:void 0,footstepAudio:null!=e.footstepAudioId&&e.footstepAudioFile?Object(s.a)({},e.footstepAudioFile,{id:e.footstepAudioId}):void 0,collisionAudio:null!=e.collisionAudioId&&e.collisionAudioFile?Object(s.a)({},e.collisionAudioFile,{id:e.collisionAudioId}):void 0,interactAvailAudio:null!=e.interactAvailAudioId&&e.interactAvailAudioFile?Object(s.a)({},e.interactAvailAudioFile,{id:e.interactAvailAudioId}):void 0})}},{key:"render",value:function(){var e=this,t=this.props,n=t.project,a=t.onDismiss,o=this.state,r=o.projectName,c=o.footstepAudio,s=o.collisionAudio,u=o.interactAvailAudio;return null!=o.audioSelectionTarget?i.a.createElement(lt,{audioLibrary:n.audioLibrary,onDismiss:this.hideAudioSelection,onSelect:this.selectAudio}):i.a.createElement(ot,{onDismiss:a,title:"Settings"},i.a.createElement(Rn,null,i.a.createElement(Jt,null,i.a.createElement(Qt,null,"General"),null!=r&&i.a.createElement(Jt,null,i.a.createElement("label",null,"Project Name"),i.a.createElement(en,{type:"text",value:r,onChange:this.onProjectNameChanged})),i.a.createElement(Jt,null,i.a.createElement("label",null,"Footstep Sound"),i.a.createElement(nn,{onClick:function(){return e.setState({audioSelectionTarget:In.Footstep})}},c?"".concat(c.name," (").concat(Math.ceil(c.data.byteLength/1024)," KiB)"):"No audio selected")),i.a.createElement(Jt,null,i.a.createElement("label",null,"Collision Sound"),i.a.createElement(nn,{onClick:function(){return e.setState({audioSelectionTarget:In.Collision})}},s?"".concat(s.name," (").concat(Math.ceil(s.data.byteLength/1024)," KiB)"):"No audio selected")),i.a.createElement(Jt,null,i.a.createElement("label",null,"Interaction Available Sound"),i.a.createElement(nn,{onClick:function(){return e.setState({audioSelectionTarget:In.InteractAvail})}},u?"".concat(u.name," (").concat(Math.ceil(u.data.byteLength/1024)," KiB)"):"No audio selected"))),i.a.createElement(Jt,null,i.a.createElement(Qt,null,"Web Audio API"),i.a.createElement(Jt,null,i.a.createElement("label",null,"Panning Model"),i.a.createElement(tn,{value:this.state.panningModel,onChange:this.selectPanningModel},i.a.createElement("option",{value:"equalpower"},"Equalpower"),i.a.createElement("option",{value:"HRTF"},"HRTF"))),i.a.createElement(Jt,null,i.a.createElement("label",null,"Distance Model"),i.a.createElement(tn,{value:this.state.distanceModel,onChange:this.selectDistanceModel},i.a.createElement("option",{value:"inverse"},"Inverse"),i.a.createElement("option",{value:"linear"},"Linear"),i.a.createElement("option",{value:"exponential"},"Exponential")))),i.a.createElement(Jt,null,i.a.createElement(Qt,null,"Resonance Audio"),i.a.createElement(Jt,null,i.a.createElement("label",null,"Ambisonic Order"),i.a.createElement(tn,{value:this.state.ambisonicOrder,onChange:this.selectAmbisonicOrder},i.a.createElement("option",{value:1},"First-Order Ambisonics"),i.a.createElement("option",{value:2},"Second-Order Ambisonics"),i.a.createElement("option",{value:3},"Third-Order Ambisonics"))),i.a.createElement(Jt,null,i.a.createElement("label",null,"Rollof Model"),i.a.createElement(tn,{value:this.state.rollofModel,onChange:this.selectRollofModel},i.a.createElement("option",{value:"logarithmic"},"Logarithmic"),i.a.createElement("option",{value:"linear"},"Linear"),i.a.createElement("option",{value:"none"},"None"))))),i.a.createElement(nt,null,i.a.createElement(at,{onClick:a},"Done")))}}]),t}(i.a.Component),Ln=function(e){function t(){return Object(h.a)(this,t),Object(f.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props,t=e.spawn,n=e.onUpdateName,a=e.onUpdatePosition,o=e.onUpdateRotation;return i.a.createElement("div",null,i.a.createElement(Jt,null,i.a.createElement("label",null,"Spawn ID"),i.a.createElement(en,{type:"text",readOnly:!0,value:t.uuid,onFocus:Et})),i.a.createElement(Jt,null,i.a.createElement("label",null,"Name"),i.a.createElement(en,{type:"text",placeholder:"New spawn",value:t.name,onChange:function(e){return n(e.currentTarget.value)}})),i.a.createElement(Jt,null,i.a.createElement("label",null,"Position (x, z)"),i.a.createElement(on,null,i.a.createElement(en,{type:"number",step:.01,value:t.position.x.toFixed(2),onChange:function(e){return a(Q(e.currentTarget.valueAsNumber,.01),t.position.z)}}),i.a.createElement(en,{type:"number",step:.01,value:t.position.z.toFixed(2),onChange:function(e){return a(t.position.x,Q(e.currentTarget.valueAsNumber,.01))}}))),i.a.createElement(Jt,null,i.a.createElement("label",null,"Euler-Rotation in Degrees (y)"),i.a.createElement(on,null,i.a.createElement(en,{type:"number",step:1,value:V(t.rotation).toFixed(0),onChange:function(e){return o(J(e.currentTarget.valueAsNumber%360))}}))))}}]),t}(i.a.Component),Fn=function(e){function t(){var e,n;Object(h.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).state={name:""},n.onNameChange=function(e){n.setState({name:e.currentTarget.value})},n.submit=function(e){e.preventDefault();var t=n.state.name;t&&n.props.onSave(t)},n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.onDismiss,t=this.state.name;return i.a.createElement(ot,{title:"Save Project",onDismiss:e},i.a.createElement("form",{onSubmit:this.submit},i.a.createElement(Jt,null,i.a.createElement(en,{autoFocus:!0,required:!0,type:"text",placeholder:"Project Name",value:t,onChange:this.onNameChange})),i.a.createElement(nt,null,i.a.createElement(at,{type:"submit",disabled:!t},"Save"),i.a.createElement(at,{type:"button",onClick:e},"Cancel"))))}}]),t}(i.a.Component),Nn=function(e){function t(){return Object(h.a)(this,t),Object(f.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return i.a.createElement(ot,{title:"Project Loaded"},i.a.createElement("p",null,"The project has been loaded successfully."),i.a.createElement(nt,null,i.a.createElement(at,{onClick:this.props.onConfirm},"OK")))}}]),t}(i.a.Component);!function(e){e[e.AudioLibrary=0]="AudioLibrary",e[e.AudioSelection=1]="AudioSelection",e[e.ProjectManager=2]="ProjectManager",e[e.ProjectSelection=3]="ProjectSelection",e[e.ProjectSaver=4]="ProjectSaver",e[e.ProjectLoaded=5]="ProjectLoaded",e[e.Settings=6]="Settings"}(Dn||(Dn={})),function(e){e[e.ObjectAudio=0]="ObjectAudio",e[e.InteractionAudio=1]="InteractionAudio"}(Tn||(Tn={}));var zn=function(e){function t(e){var n;return Object(h.a)(this,t),(n=Object(f.a)(this,Object(v.a)(t).call(this,e))).project=new be,n.projectCanvas=new pn(n.project),n.state={audioImplementation:n.project.activeAudioImplementation,rooms:n.project.rooms.map(function(e){return{id:e.id,uuid:e.uuid,name:e.name,dimensions:e.dimensions,materials:e.materials}}),selectedRoomId:0,selectedSpawn:null,selectedObject:null,modal:null,project:n.project,runningProject:null},n.audioSelectionTarget=Tn.ObjectAudio,n.mainRef=i.a.createRef(),n.newProject=function(){n.project.close(),n.project=new be({onSelectSpawn:n.onSelectSpawn,onSelectObject:n.onSelectObject,onTranslate:n.onTranslateObject,onScale:n.onScaleObject}),n.projectCanvas.changeProject(n.project),n.setState({audioImplementation:n.project.activeAudioImplementation,rooms:n.project.rooms.map(function(e){return{id:e.id,uuid:e.uuid,name:e.name,dimensions:e.dimensions,materials:e.materials}}),selectedRoomId:0,selectedSpawn:null,selectedObject:null,project:n.project,modal:null})},n.showProjectSelection=Object(p.a)(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.setState({modal:Dn.ProjectSelection});case 1:case"end":return e.stop()}},e,this)})),n.saveProject=Object(p.a)(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n.project.id){e.next=4;break}n.setState({modal:Dn.ProjectSaver}),e.next=6;break;case 4:return e.next=6,n.project.save();case 6:case"end":return e.stop()}},e,this)})),n.importProject=Object(p.a)(d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,xe();case 3:t=e.sent,n.project.close(),n.project=t,e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(0),console.log("Opening project zip failed:",e.t0),alert("The selected project could not be imported, please select a valid project archive."),e.abrupt("return");case 13:n.project.events={onSelectSpawn:n.onSelectSpawn,onSelectObject:n.onSelectObject,onTranslate:n.onTranslateObject,onScale:n.onScaleObject},n.projectCanvas.changeProject(n.project),n.setState({audioImplementation:n.project.activeAudioImplementation,rooms:n.project.rooms.map(function(e){return{id:e.id,uuid:e.uuid,name:e.name,dimensions:e.dimensions,materials:e.materials}}),selectedRoomId:0,selectedSpawn:null,selectedObject:null,project:n.project,modal:Dn.ProjectLoaded});case 16:case"end":return e.stop()}},e,this,[[0,8]])})),n.exportProject=function(){S(n.project)},n.addObject=function(){var e=n.project.activeRoom.addObject();n.project.selectObject(e)},n.deleteObject=function(){n.project.activeObject&&(n.project.activeRoom.remove(n.project.activeObject),n.project.activeObject.audio.stop(),n.project.unselect())},n.addSpawn=function(){var e=n.project.activeRoom.addSpawn();n.project.selectSpawn(e)},n.deleteSpawn=function(){var e=n.project.activeRoom.spawns;n.project.activeSpawn&&e.length>1&&(e.splice(e.indexOf(n.project.activeSpawn)),n.project.activeRoom.remove(n.project.activeSpawn),n.project.activeSpawn=null,n.project.unselect())},n.addRoom=function(){var e=n.project.addRoom();n.setState(function(t){return{rooms:[].concat(Object(u.a)(t.rooms),[{id:e.id,uuid:e.uuid,name:e.name,dimensions:e.dimensions,materials:e.materials}]),selectedRoomId:t.rooms.length}})},n.deleteRoom=function(){n.state.selectedRoomId>0&&(n.project.rooms.splice(n.state.selectedRoomId,1),n.setState(function(e){return{rooms:[].concat(Object(u.a)(e.rooms.slice(0,e.selectedRoomId)),Object(u.a)(e.rooms.slice(e.selectedRoomId+1))),selectedRoomId:0}}))},n.showAudioLibrary=function(){n.setState({modal:Dn.AudioLibrary})},n.showProjectManager=function(){n.setState({modal:Dn.ProjectManager})},n.selectAudioImplementation=function(e){n.project.selectAudioImplementation(e),n.setState({audioImplementation:e})},n.runProject=function(){n.projectCanvas.detach();var e=(new be).fromData(n.project.toData(),n.project.id,n.project.audioLibrary);n.project.suspend(),n.setState({runningProject:e})},n.showSettings=function(){n.setState({modal:Dn.Settings})},n.updateRoomName=function(e){n.project.activeRoom.name=e,n.setState(function(t){var n=t.rooms,a=t.selectedRoomId;return{rooms:[].concat(Object(u.a)(n.slice(0,a)),[Object(s.a)({},n[a],{name:e})],Object(u.a)(n.slice(a+1)))}})},n.updateRoomDimensions=function(e){n.project.activeRoom.dimensions=e,n.setState(function(t){var n=t.rooms,a=t.selectedRoomId;return{rooms:[].concat(Object(u.a)(n.slice(0,a)),[Object(s.a)({},n[a],{dimensions:e})],Object(u.a)(n.slice(a+1)))}})},n.updateRoomMaterials=function(e){n.project.activeRoom.materials=e,n.setState(function(t){var n=t.rooms,a=t.selectedRoomId;return{rooms:[].concat(Object(u.a)(n.slice(0,a)),[Object(s.a)({},n[a],{materials:e})],Object(u.a)(n.slice(a+1)))}})},n.updateSpawnName=function(e){n.project.activeSpawn&&(n.project.activeSpawn.name=e),n.setState(function(t){var n=t.selectedSpawn;return{selectedSpawn:n&&Object(s.a)({},n,{name:e})}})},n.updateSpawnPosition=function(e,t){n.project.activeSpawn&&(n.project.activeSpawn.position.x=e,n.project.activeSpawn.position.z=t),n.setState(function(n){var a=n.selectedSpawn;return{selectedSpawn:a&&Object(s.a)({},a,{position:new j.v(e,0,t)})}})},n.updateSpawnRotation=function(e){n.project.activeSpawn&&(n.project.activeSpawn.rotation.y=e),n.setState(function(t){var n=t.selectedSpawn;return{selectedSpawn:n&&Object(s.a)({},n,{rotation:e})}})},n.updateObjectName=function(e){n.project.activeObject&&(n.project.activeObject.name=e),n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{name:e})}})},n.updateObjectVolume=function(e){n.project.activeObject&&(n.project.activeObject.volume=e),n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{volume:e})}})},n.updateObjectScale=function(e,t,a){n.project.activeObject&&n.project.activeObject.scale.set(e,t,a),n.setState(function(n){var o=n.selectedObject;return{selectedObject:o&&Object(s.a)({},o,{scale:new j.v(e,t,a)})}})},n.updateObjectPosition=function(e,t,a){n.project.activeObject&&n.project.activeObject.position.set(e,t,a),n.setState(function(n){var o=n.selectedObject;return{selectedObject:o&&Object(s.a)({},o,{position:new j.v(e,t,a)})}})},n.updateObjectRotation=function(e,t,a){n.project.activeObject&&n.project.activeObject.rotation.set(e,t,a),n.setState(function(n){var o=n.selectedObject;return{selectedObject:o&&Object(s.a)({},o,{rotation:new j.g(e,t,a)})}})},n.updateObjectInteractionType=function(e){var t={roomId:n.project.rooms[0].uuid,spawnId:""};n.project.activeObject&&(n.project.activeObject.interactionType=e,n.project.activeObject.teleportTarget=n.project.activeObject.teleportTarget||t),n.setState(function(n){var a=n.selectedObject;return{selectedObject:a&&Object(s.a)({},a,{interactionType:e,teleportTarget:a.teleportTarget||t})}})},n.updateObjectCodeBlockSource=function(e){n.project.activeObject&&(n.project.activeObject.codeBlock?n.project.activeObject.codeBlock.update(e):n.project.activeObject.codeBlock=new H(e)),n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{codeBlockSource:e})}})},n.updateObjectTeleportTarget=function(e){n.project.activeObject&&(n.project.activeObject.teleportTarget=e),n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{teleportTarget:e})}})},n.showAudioSelection=function(){n.audioSelectionTarget=Tn.ObjectAudio,n.setState({modal:Dn.AudioSelection})},n.showInteractionAudioSelection=function(){n.audioSelectionTarget=Tn.InteractionAudio,n.setState({modal:Dn.AudioSelection})},n.dismissModal=function(){n.setState({modal:null})},n.selectAudio=function(e){n.project.activeObject&&(n.audioSelectionTarget===Tn.InteractionAudio?(n.project.activeObject.interactionAudioId=e.id,n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{interactionAudio:e}),modal:null}})):(n.project.activeRoom.audioScene.resume(),n.project.activeObject.playAudio(e.id,!0),n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{audio:e}),modal:null}})))},n.loadProject=function(e){try{var t=(new be).fromData(e,e.id);n.project.close(),n.project=t}catch(a){console.log("Loading project failed:",a),alert("The selected project could not be loaded")}n.project.events={onSelectSpawn:n.onSelectSpawn,onSelectObject:n.onSelectObject,onTranslate:n.onTranslateObject,onScale:n.onScaleObject},n.projectCanvas.changeProject(n.project),n.setState({audioImplementation:n.project.activeAudioImplementation,rooms:n.project.rooms.map(function(e){return{id:e.id,uuid:e.uuid,name:e.name,dimensions:e.dimensions,materials:e.materials}}),selectedRoomId:0,selectedSpawn:null,selectedObject:null,project:n.project,modal:Dn.ProjectLoaded})},n.saveNewProject=function(){var e=Object(p.a)(d.a.mark(function e(t){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.project.name=t,e.next=3,n.project.save();case 3:n.dismissModal();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.resumeProject=function(){n.project.resume(),n.dismissModal()},n.onSelectSpawn=function(e){n.setState({selectedSpawn:e&&{id:e.id,uuid:e.uuid,name:e.name,position:e.position,rotation:e.rotation.y},selectedObject:null})},n.onSelectObject=function(){var e=Object(p.a)(d.a.mark(function e(t){var a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||null==t.interactionAudioId){e.next=6;break}return e.next=3,n.project.audioLibrary.get(t.interactionAudioId);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=void 0;case 7:a=e.t0,n.setState({selectedSpawn:null,selectedObject:t&&{id:t.id,uuid:t.uuid,name:t.name,volume:t.volume,position:t.position,scale:t.scale,rotation:t.rotation,audio:t.audioFile&&null!=t.audioId?Object(s.a)({},t.audioFile,{id:t.audioId}):void 0,interactionType:t.interactionType,codeBlockSource:t.codeBlock&&t.codeBlock.source,teleportTarget:t.teleportTarget,interactionAudio:a&&null!=t.interactionAudioId?Object(s.a)({},a,{id:t.interactionAudioId}):void 0}});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.onTranslateObject=function(e){n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{position:e})}})},n.onScaleObject=function(e){n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{size:{width:e.x,height:e.y,depth:e.z}})}})},n.exitRuntime=function(){if(n.state.runningProject){var e=n.state.runningProject.activeAudioImplementation;n.state.runningProject.close(),n.project.selectAudioImplementation(e),n.setState({runningProject:null,audioImplementation:e})}},n.attachCanvas=function(e){null!=e?(n.projectCanvas.attach(e),n.projectCanvas.focus()):n.projectCanvas.detach()},n.project.events={onSelectSpawn:n.onSelectSpawn,onSelectObject:n.onSelectObject,onTranslate:n.onTranslateObject,onScale:n.onScaleObject},n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"selectRoom",value:function(e){this.project.selectRoom(this.project.rooms[e]),this.setState({selectedRoomId:e})}},{key:"componentWillUnmount",value:function(){this.projectCanvas.detach()}},{key:"render",value:function(){var e=this,t=this.state,n=t.modal,a=t.runningProject,o=t.audioImplementation,r=this.state,c=r.selectedSpawn,s=r.selectedObject;return a?i.a.createElement(We,{project:a,onExit:this.exitRuntime}):i.a.createElement(Gt,null,(n===Dn.AudioLibrary||n===Dn.AudioSelection)&&i.a.createElement(lt,{audioLibrary:this.project.audioLibrary,onDismiss:this.dismissModal,onSelect:n===Dn.AudioSelection?this.selectAudio:void 0}),(n===Dn.ProjectManager||n===Dn.ProjectSelection)&&i.a.createElement(Mn,{onNewProject:this.newProject,onDismiss:this.dismissModal,onSelectProject:n===Dn.ProjectSelection?this.loadProject:void 0}),n===Dn.ProjectSaver&&i.a.createElement(Fn,{onSave:this.saveNewProject,onDismiss:this.dismissModal}),n===Dn.ProjectLoaded&&i.a.createElement(Nn,{onConfirm:this.resumeProject}),n===Dn.Settings&&i.a.createElement(Bn,{project:this.project,onDismiss:this.dismissModal}),i.a.createElement(kt,{audioImplementation:o,onAudioChange:this.selectAudioImplementation,onNewProject:this.newProject,onLoadProject:this.showProjectSelection,onSaveProject:this.saveProject,onImportProject:this.importProject,onExportProject:this.exportProject,onShowSettings:this.showSettings,onAddObject:this.addObject,onDeleteObject:this.deleteObject,onAddSpawn:this.addSpawn,onDeleteSpawn:this.deleteSpawn,onAddRoom:this.addRoom,onDeleteRoom:this.deleteRoom,onShowAudioLibrary:this.showAudioLibrary,onShowProjectManager:this.showProjectManager,onRunProject:this.runProject}),i.a.createElement(Kt,null,i.a.createElement(Vt,null,i.a.createElement(Jt,null,i.a.createElement("label",null,"Rooms"),i.a.createElement(rn,null,this.state.rooms.map(function(t,n){return i.a.createElement(cn,{key:t.id,onClick:function(){return e.selectRoom(n)},active:n===e.state.selectedRoomId},t.name||"Anonymous Room")}))),!(c||s)&&i.a.createElement(fn,{room:this.state.rooms[this.state.selectedRoomId],onUpdateName:this.updateRoomName,onUpdateDimensions:this.updateRoomDimensions,onUpdateMaterials:this.updateRoomMaterials}),c&&i.a.createElement(Ln,{spawn:c,onUpdateName:this.updateSpawnName,onUpdatePosition:this.updateSpawnPosition,onUpdateRotation:this.updateSpawnRotation}),s&&i.a.createElement(sn,{object:s,rooms:this.project.rooms,onUpdateName:this.updateObjectName,onUpdateVolume:this.updateObjectVolume,onUpdatePosition:this.updateObjectPosition,onUpdateRotation:this.updateObjectRotation,onUpdateScale:this.updateObjectScale,onUpdateInteractionType:this.updateObjectInteractionType,onUpdateCodeBlockSource:this.updateObjectCodeBlockSource,onUpdateTeleportTarget:this.updateObjectTeleportTarget,onShowAudioSelection:this.showAudioSelection,onShowInteractionAudioSelection:this.showInteractionAudioSelection})),i.a.createElement(qt,{ref:this.attachCanvas},i.a.createElement(_t,null,"Focused"))))}}]),t}(i.a.Component);n(139),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));if(!window.AudioContext&&window.webkitAudioContext&&(window.AudioContext=window.webkitAudioContext),window.nw){var Un=window.nw,Yn=Un.Window.get();Yn.maximize(),Yn.focus(),Yn.on("new-win-policy",function(e,t,n){n&&t&&(n.ignore(),Un.Shell.openExternal(t))}),Yn.on("close",function(){confirm("Do you really want to quit? There might be unsaved changes.")&&Yn.close(!0)})}window.addEventListener("beforeunload",function(e){return e.preventDefault()}),c.a.render(i.a.createElement(zn,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},79:function(e,t,n){e.exports=n(141)},92:function(e,t){},94:function(e,t){}},[[79,2,1]]]);
//# sourceMappingURL=main.fcc4d8df.chunk.js.map